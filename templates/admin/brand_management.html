<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>브랜드 관리 - your_program Manager</title>
    <link rel="stylesheet" href="/static/css/tailwind.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="/static/js/theme.js"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="min-h-screen flex">
        <!-- 사이드바 -->
        <div class="w-64 bg-white dark:bg-gray-800 shadow-lg flex flex-col">
            <div class="p-6 flex-shrink-0">
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">🍽️ your_program</h1>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">관리자 대시보드</p>
            </div>
            
            <nav class="mt-6 flex-1">
                <div class="px-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">메인 메뉴</h3>
                </div>
                
                <a href="/admin_dashboard" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    대시보드
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">브랜드 관리</h3>
                </div>
                
                <div class="space-y-1">
                    <a href="/admin/brand-manager-approval" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-user-check mr-3"></i>
                        브랜드 관리자 승인
                    </a>
                    <a href="/admin/brand-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 bg-blue-50 dark:bg-blue-900 border-r-2 border-blue-500">
                        <i class="fas fa-building mr-3"></i>
                        브랜드별 관리
                    </a>
                </div>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">매장 관리</h3>
                </div>
                
                <a href="/admin/store-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-store mr-3"></i>
                    매장별 관리
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">직원 관리</h3>
                </div>
                
                <a href="/admin/employee-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-users mr-3"></i>
                    직원별 관리
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">모듈/플러그인</h3>
                </div>
                
                <a href="/admin/module-marketplace" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-puzzle-piece mr-3"></i>
                    모듈 마켓플레이스
                </a>
                <a href="/admin/module-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-cogs mr-3"></i>
                    모듈 관리
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">시스템 관리</h3>
                </div>
                
                <a href="/admin/feedback-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-comments mr-3"></i>
                    피드백 관리
                </a>
            </nav>
            
            <div class="p-6 flex-shrink-0 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <button id="theme-toggle" class="theme-toggle-btn" title="테마 변경">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </button>
                    <a href="/auth/logout" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- 헤더 -->
            <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                <div class="px-6 py-4">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">브랜드 관리</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">브랜드 생성, 수정, 삭제 및 관리</p>
                </div>
            </header>

            <!-- 메인 콘텐츠 -->
            <main class="flex-1 overflow-auto p-6">
                <div class="container mx-auto px-4 py-8">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">브랜드 관리</h1>
                        <button onclick="openCreateModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            새 브랜드 추가
                        </button>
                    </div>

                    <!-- 브랜드 목록 -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                            <h2 class="text-xl font-semibold text-gray-800 dark:text-white">브랜드 목록</h2>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">브랜드명</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">브랜드 코드</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">업종</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">상태</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">생성일</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">관리</th>
                                    </tr>
                                </thead>
                                <tbody id="brandList" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <!-- 브랜드 목록이 여기에 동적으로 로드됩니다 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

<!-- 브랜드 생성 모달 -->
<div id="createBrandModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">새 브랜드 추가</h3>
                <button onclick="closeCreateModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="createBrandForm" class="space-y-4">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <!-- 업종 선택 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">업종 *</label>
                    <select id="industrySelect" name="industry_name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" required>
                        <option value="">업종을 선택하세요</option>
                    </select>
                </div>

                <!-- 브랜드명 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">브랜드명 *</label>
                    <input type="text" id="brandName" name="name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" required>
                </div>

                <!-- 브랜드 코드 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">브랜드 코드</label>
                    <div class="flex space-x-2">
                        <input type="text" id="brandCode" name="code" class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" placeholder="자동 생성됩니다">
                        <button type="button" onclick="generateBrandCode()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md text-sm">
                            자동 생성
                        </button>
                    </div>
                    <div id="codeSuggestions" class="mt-2 space-y-1 hidden">
                        <p class="text-sm text-gray-600 dark:text-gray-400">추천 코드:</p>
                        <div id="suggestionButtons" class="flex flex-wrap gap-2">
                            <!-- 제안 버튼들이 여기에 생성됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 설명 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">설명</label>
                    <textarea id="brandDescription" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"></textarea>
                </div>

                <!-- 연락처 정보 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">이메일</label>
                        <input type="email" id="brandEmail" name="contact_email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">전화번호</label>
                        <input type="tel" id="brandPhone" name="contact_phone" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                    </div>
                </div>

                <!-- 웹사이트 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">웹사이트</label>
                    <input type="url" id="brandWebsite" name="website" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                </div>

                <!-- 주소 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">주소</label>
                    <input type="text" id="brandAddress" name="address" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                </div>

                <!-- 프론트엔드 서버 생성 -->
                <div class="flex items-center">
                    <input type="checkbox" id="createFrontendServer" name="create_frontend_server" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                    <label for="createFrontendServer" class="ml-2 block text-sm text-gray-900 dark:text-white">
                        프론트엔드 서버 자동 생성
                    </label>
                </div>

                <!-- 버튼 -->
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeCreateModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 dark:text-gray-200 rounded-md">
                        취소
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">
                        브랜드 생성
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 브랜드 수정 모달 -->
<div id="editBrandModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white">브랜드 수정</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <form id="editBrandForm" class="space-y-4">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" id="editBrandId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">브랜드명 *</label>
                    <input type="text" id="editBrandName" name="name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">설명</label>
                    <textarea id="editBrandDescription" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">이메일</label>
                        <input type="email" id="editBrandEmail" name="contact_email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">전화번호</label>
                        <input type="tel" id="editBrandPhone" name="contact_phone" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">웹사이트</label>
                    <input type="url" id="editBrandWebsite" name="website" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">주소</label>
                    <input type="text" id="editBrandAddress" name="address" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">상태</label>
                    <select id="editBrandStatus" name="status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        <option value="active">활성</option>
                        <option value="inactive">비활성</option>
                        <option value="suspended">일시정지</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeEditModal()" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 dark:text-gray-200 rounded-md">
                        취소
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">
                        수정
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let industries = [];

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    loadIndustries();
    loadBrands();
});

// 업종 목록 로드
async function loadIndustries() {
    try {
        const response = await fetch('/api/admin/industries');
        const data = await response.json();
        
        if (response.ok) {
            industries = data.industries;
            const industrySelect = document.getElementById('industrySelect');
            
            // 기존 옵션 제거 (첫 번째 옵션 제외)
            while (industrySelect.children.length > 1) {
                industrySelect.removeChild(industrySelect.lastChild);
            }
            
            // 업종 옵션 추가
            industries.forEach(industry => {
                const option = document.createElement('option');
                option.value = industry.name;
                option.textContent = industry.name;
                industrySelect.appendChild(option);
            });
        } else {
            console.error('업종 목록 로드 실패:', data.error);
        }
    } catch (error) {
        console.error('업종 목록 로드 오류:', error);
    }
}

// 브랜드 목록 로드
async function loadBrands() {
    try {
        const response = await fetch('/api/admin/brands');
        const data = await response.json();
        
        if (response.ok) {
            displayBrands(data.brands);
        } else {
            console.error('브랜드 목록 로드 실패:', data.error);
        }
    } catch (error) {
        console.error('브랜드 목록 로드 오류:', error);
    }
}

// 브랜드 목록 표시
function displayBrands(brands) {
    const brandList = document.getElementById('brandList');
    brandList.innerHTML = '';
    
    if (brands.length === 0) {
        brandList.innerHTML = `
            <tr>
                <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                    등록된 브랜드가 없습니다.
                </td>
            </tr>
        `;
        return;
    }
    
    brands.forEach(brand => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900 dark:text-white">${brand.name}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900 dark:text-white font-mono">${brand.code}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900 dark:text-white">-</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                    brand.status === 'active' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 
                    brand.status === 'inactive' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 
                    'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'
                }">
                    ${brand.status === 'active' ? '활성' : brand.status === 'inactive' ? '비활성' : '일시정지'}
                </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                ${brand.created_at ? new Date(brand.created_at).toLocaleDateString() : '-'}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button onclick="editBrand(${brand.id})" class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3">수정</button>
                <button onclick="deleteBrand(${brand.id})" class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">삭제</button>
            </td>
        `;
        brandList.appendChild(row);
    });
}

// 브랜드 코드 자동 생성
async function generateBrandCode() {
    const industryName = document.getElementById('industrySelect').value;
    const brandName = document.getElementById('brandName').value;
    
    if (!industryName || !brandName) {
        alert('업종과 브랜드명을 먼저 입력해주세요.');
        return;
    }
    
    try {
        const response = await fetch('/api/admin/brands/code-suggestions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                industry_name: industryName,
                brand_name: brandName
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            // 자동 생성된 코드를 입력 필드에 설정
            document.getElementById('brandCode').value = data.auto_generated;
            
            // 제안 코드들 표시
            displayCodeSuggestions(data.suggestions);
        } else {
            console.error('브랜드 코드 생성 실패:', data.error);
        }
    } catch (error) {
        console.error('브랜드 코드 생성 오류:', error);
    }
}

// 제안 코드 표시
function displayCodeSuggestions(suggestions) {
    const suggestionsDiv = document.getElementById('codeSuggestions');
    const buttonsDiv = document.getElementById('suggestionButtons');
    
    buttonsDiv.innerHTML = '';
    
    suggestions.forEach(suggestion => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-800 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-white rounded text-sm';
        button.textContent = suggestion;
        button.onclick = () => {
            document.getElementById('brandCode').value = suggestion;
        };
        buttonsDiv.appendChild(button);
    });
    
    suggestionsDiv.classList.remove('hidden');
}

// 모달 열기/닫기
function openCreateModal() {
    document.getElementById('createBrandModal').classList.remove('hidden');
    document.getElementById('createBrandForm').reset();
    document.getElementById('codeSuggestions').classList.add('hidden');
}

function closeCreateModal() {
    document.getElementById('createBrandModal').classList.add('hidden');
}

function openEditModal() {
    document.getElementById('editBrandModal').classList.remove('hidden');
}

function closeEditModal() {
    document.getElementById('editBrandModal').classList.add('hidden');
}

// 브랜드 생성
document.getElementById('createBrandForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    
    // 체크박스 값 처리
    data.create_frontend_server = document.getElementById('createFrontendServer').checked;
    
    try {
        const response = await fetch('/api/admin/brands', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': data.csrf_token
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            console.log('브랜드 생성 성공:', result);
            alert('브랜드가 성공적으로 생성되었습니다. 서버 설정 페이지로 이동합니다.');
            closeCreateModal();
            
            // 생성된 브랜드의 서버 설정 페이지로 이동
            if (result.brand && result.brand.id) {
                console.log('서버 설정 페이지로 이동:', `/admin/brand/${result.brand.id}/server-setup`);
                window.location.href = `/admin/brand/${result.brand.id}/server-setup`;
            } else {
                console.log('브랜드 정보가 없어 브랜드 목록을 새로고침합니다.');
                loadBrands();
            }
        } else {
            let errorMessage = '브랜드 생성 실패: ' + result.error;
            if (result.traceback) {
                console.error('브랜드 생성 오류 상세:', result.traceback);
                errorMessage += '\n\n상세 오류는 브라우저 콘솔을 확인하세요.';
            }
            alert(errorMessage);
        }
    } catch (error) {
        console.error('브랜드 생성 오류:', error);
        alert('브랜드 생성 중 오류가 발생했습니다.');
    }
});

// 브랜드 수정
async function editBrand(brandId) {
    try {
        const response = await fetch(`/api/admin/brands/${brandId}`);
        const data = await response.json();
        
        if (response.ok) {
            const brand = data.brand;
            
            document.getElementById('editBrandId').value = brand.id;
            document.getElementById('editBrandName').value = brand.name;
            document.getElementById('editBrandDescription').value = brand.description || '';
            document.getElementById('editBrandEmail').value = brand.contact_email || '';
            document.getElementById('editBrandPhone').value = brand.contact_phone || '';
            document.getElementById('editBrandWebsite').value = brand.website || '';
            document.getElementById('editBrandAddress').value = brand.address || '';
            document.getElementById('editBrandStatus').value = brand.status;
            
            openEditModal();
        } else {
            alert('브랜드 정보 로드 실패: ' + data.error);
        }
    } catch (error) {
        console.error('브랜드 정보 로드 오류:', error);
        alert('브랜드 정보 로드 중 오류가 발생했습니다.');
    }
}

// 브랜드 수정 폼 제출
document.getElementById('editBrandForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const brandId = document.getElementById('editBrandId').value;
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch(`/api/admin/brands/${brandId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': data.csrf_token
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            alert('브랜드가 성공적으로 수정되었습니다.');
            closeEditModal();
            loadBrands();
        } else {
            alert('브랜드 수정 실패: ' + result.error);
        }
    } catch (error) {
        console.error('브랜드 수정 오류:', error);
        alert('브랜드 수정 중 오류가 발생했습니다.');
    }
});

// 브랜드 삭제
async function deleteBrand(brandId) {
    if (!confirm('정말로 이 브랜드를 삭제하시겠습니까?')) {
        return;
    }
    
    // CSRF 토큰 가져오기
    const csrfToken = document.querySelector('input[name="csrf_token"]').value;
    
    try {
        const response = await fetch(`/api/admin/brands/${brandId}`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': csrfToken
            }
        });
        
        const result = await response.json();
        
        if (response.ok) {
            alert('브랜드가 성공적으로 삭제되었습니다.');
            loadBrands();
        } else {
            alert('브랜드 삭제 실패: ' + result.error);
        }
    } catch (error) {
        console.error('브랜드 삭제 오류:', error);
        alert('브랜드 삭제 중 오류가 발생했습니다.');
    }
}
</script>
</body>
</html> 