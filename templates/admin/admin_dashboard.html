<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - your_program Manager</title>
    <link href="/static/css/tailwind-built.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/theme.js"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div class="min-h-screen flex">
        <!-- 사이드바 -->
        <div class="w-64 bg-white dark:bg-gray-800 shadow-lg flex flex-col">
            <div class="p-6 flex-shrink-0">
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">🍽️ your_program</h1>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">관리자 대시보드</p>
            </div>
            
            <nav class="mt-6 flex-1">
                <div class="px-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">메인 메뉴</h3>
                </div>
                
                <a href="/admin_dashboard" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 bg-blue-50 dark:bg-blue-900 border-r-2 border-blue-500">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    대시보드
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">브랜드 관리</h3>
                </div>
                
                <div class="space-y-1">
                    <a href="/admin/brand-manager-approval" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-user-check mr-3"></i>
                        브랜드 관리자 승인
                    </a>
                    <a href="/admin/brand-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-building mr-3"></i>
                        브랜드별 관리
                    </a>
                </div>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">매장 관리</h3>
                </div>
                
                <a href="/admin/store-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-store mr-3"></i>
                    매장별 관리
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">직원 관리</h3>
                </div>
                
                <a href="/admin/employee-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-users mr-3"></i>
                    직원별 관리
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">모듈 관리</h3>
                </div>
                
                <a href="/admin/module-marketplace" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-puzzle-piece mr-3"></i>
                    모듈 마켓플레이스
                </a>
                <a href="/admin/module-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-cogs mr-3"></i>
                    모듈 관리
                </a>
                
                <div class="px-6 mt-6 mb-4">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">시스템 관리</h3>
                </div>
                
                <a href="/admin/feedback-management" class="flex items-center px-6 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="fas fa-comments mr-3"></i>
                    피드백 관리
                </a>
            </nav>
            
            <div class="p-6 flex-shrink-0 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <button id="theme-toggle" class="theme-toggle-btn" title="테마 변경">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </button>
                    <a href="/auth/logout" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- 헤더 -->
            <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                <div class="px-6 py-4">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">브랜드 현황 대시보드</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">전체 브랜드와 매장의 운영 현황을 한눈에 확인하세요</p>
                </div>
            </header>

            <!-- 메인 콘텐츠 -->
            <main class="flex-1 overflow-auto p-6">
                <!-- 전체 통계 카드 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900">
                                <i class="fas fa-store text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">총 브랜드</p>
                                <p class="text-2xl font-semibold text-gray-900 dark:text-white" id="total-brands">0개</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 dark:bg-green-900">
                                <i class="fas fa-building text-green-600 dark:text-green-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">총 매장</p>
                                <p class="text-2xl font-semibold text-gray-900 dark:text-white" id="total-stores">0개</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900">
                                <i class="fas fa-users text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">총 직원</p>
                                <p class="text-2xl font-semibold text-gray-900 dark:text-white" id="total-employees">0명</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-orange-100 dark:bg-orange-900">
                                <i class="fas fa-shopping-cart text-orange-600 dark:text-orange-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">총 주문</p>
                                <p class="text-2xl font-semibold text-gray-900 dark:text-white" id="total-orders">0건</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 브랜드별 현황 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- 브랜드별 매장 분포 차트 -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">브랜드별 매장 분포</h3>
                        <div class="relative h-80">
                            <canvas id="brandStoresChart"></canvas>
                        </div>
                    </div>

                    <!-- 브랜드별 직원 분포 차트 -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">브랜드별 직원 분포</h3>
                        <div class="relative h-80">
                            <canvas id="brandEmployeesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 브랜드별 상세 현황 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">브랜드별 상세 현황</h3>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="brand-details">
                            <!-- 브랜드별 상세 정보가 여기에 동적으로 로드됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 최근 활동 -->
                <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">최근 활동</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4" id="recent-activities">
                            <!-- 최근 활동이 여기에 동적으로 로드됩니다 -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let brandStoresChart, brandEmployeesChart;

        // 브랜드별 현황 데이터 로드
        function loadDashboardData() {
            fetch('/api/admin/brand_stats')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const stats = data.stats || [];
                    updateStatistics(stats);
                    updateBrandCharts(stats);
                    updateBrandDetails(stats);
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    // 오류 시 기본값으로 초기화
                    updateStatistics([]);
                    updateBrandCharts([]);
                    updateBrandDetails([]);
                });
        }

        // 통계 업데이트
        function updateStatistics(stats) {
            let totalBrands = 0;
            let totalStores = 0;
            let totalEmployees = 0;
            let totalOrders = 0;

            if (stats && Array.isArray(stats)) {
                stats.forEach(brand => {
                    totalBrands++;
                    totalStores += brand.store_count || 0;
                    totalEmployees += brand.employee_count || 0;
                    totalOrders += brand.order_count || 0;
                });
            }

            document.getElementById('total-brands').textContent = totalBrands + '개';
            document.getElementById('total-stores').textContent = totalStores + '개';
            document.getElementById('total-employees').textContent = totalEmployees + '명';
            document.getElementById('total-orders').textContent = totalOrders + '건';
        }

        // 브랜드별 차트 업데이트
        function updateBrandCharts(stats) {
            if (!stats || !Array.isArray(stats) || stats.length === 0) {
                // 데이터가 없으면 빈 차트 표시
                const storesCtx = document.getElementById('brandStoresChart').getContext('2d');
                const employeesCtx = document.getElementById('brandEmployeesChart').getContext('2d');
                
                if (brandStoresChart) brandStoresChart.destroy();
                if (brandEmployeesChart) brandEmployeesChart.destroy();
                
                brandStoresChart = new Chart(storesCtx, {
                    type: 'doughnut',
                    data: { labels: ['데이터 없음'], datasets: [{ data: [1], backgroundColor: ['#E5E7EB'] }] },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
                                }
                            }
                        }
                    }
                });
                
                brandEmployeesChart = new Chart(employeesCtx, {
                    type: 'bar',
                    data: { labels: ['데이터 없음'], datasets: [{ label: '직원 수', data: [0], backgroundColor: '#E5E7EB' }] },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { y: { beginAtZero: true } },
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
                                }
                            }
                        }
                    }
                });
                return;
            }
            
            const brandNames = stats.map(brand => brand.brand_name || '알 수 없음');
            const storeCounts = stats.map(brand => brand.store_count || 0);
            const employeeCounts = stats.map(brand => brand.employee_count || 0);

            // 브랜드별 매장 분포 차트
            const storesCtx = document.getElementById('brandStoresChart').getContext('2d');
            if (brandStoresChart) {
                brandStoresChart.destroy();
            }
            brandStoresChart = new Chart(storesCtx, {
                type: 'doughnut',
                data: {
                    labels: brandNames,
                    datasets: [{
                        data: storeCounts,
                        backgroundColor: [
                            '#3B82F6', '#10B981', '#F59E0B', '#EF4444',
                            '#8B5CF6', '#06B6D4', '#84CC16', '#F97316'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000',
                                padding: 10,
                                usePointStyle: true
                            }
                        }
                    },
                    layout: {
                        padding: {
                            top: 10,
                            bottom: 20
                        }
                    }
                }
            });

            // 브랜드별 직원 분포 차트
            const employeesCtx = document.getElementById('brandEmployeesChart').getContext('2d');
            if (brandEmployeesChart) {
                brandEmployeesChart.destroy();
            }
            brandEmployeesChart = new Chart(employeesCtx, {
                type: 'bar',
                data: {
                    labels: brandNames,
                    datasets: [{
                        label: '직원 수',
                        data: employeeCounts,
                        backgroundColor: '#8B5CF6',
                        borderColor: '#7C3AED',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000'
                            }
                        }
                    },
                    layout: {
                        padding: {
                            top: 10,
                            bottom: 20
                        }
                    }
                }
            });
        }

        // 브랜드별 상세 정보 업데이트
        function updateBrandDetails(stats) {
            const brandDetails = document.getElementById('brand-details');
            brandDetails.innerHTML = '';

            if (!stats || !Array.isArray(stats) || stats.length === 0) {
                brandDetails.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-info-circle text-2xl mb-2"></i>
                        <p>브랜드 데이터가 없습니다.</p>
                    </div>
                `;
                return;
            }

            stats.forEach(brand => {
                const brandCard = document.createElement('div');
                brandCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-4';
                brandCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white">${brand.brand_name || '알 수 없음'}</h4>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${brand.brand_code || 'N/A'}</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex justify-between">
                            <span>매장:</span>
                            <span class="font-medium">${brand.store_count || 0}개</span>
                        </div>
                        <div class="flex justify-between">
                            <span>직원:</span>
                            <span class="font-medium">${brand.employee_count || 0}명</span>
                        </div>
                        <div class="flex justify-between">
                            <span>주문:</span>
                            <span class="font-medium">${brand.order_count || 0}건</span>
                        </div>
                        <div class="flex justify-between">
                            <span>상태:</span>
                            <span class="px-2 py-1 text-xs rounded-full ${
                                brand.status === 'active' 
                                    ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' 
                                    : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300'
                            }">
                                ${brand.status === 'active' ? '활성' : '비활성'}
                            </span>
                        </div>
                    </div>
                `;
                brandDetails.appendChild(brandCard);
            });
        }

        // 최근 활동 로드
        function loadRecentActivities() {
            // 실제 구현에서는 최근 활동 API를 호출
            const recentActivities = document.getElementById('recent-activities');
            recentActivities.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-white">백다방 강남점에서 새로운 직원이 등록되었습니다.</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">5분 전</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-white">초선마리 홍대점에서 주문이 완료되었습니다.</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">10분 전</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-white">카페베네 신촌점에서 재고 부족 알림이 발생했습니다.</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">15분 전</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-white">스타벅스 명동점에서 브랜드 관리자가 승인되었습니다.</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">30분 전</p>
                    </div>
                </div>
            `;
        }

        // 페이지 로드 시 데이터 로드
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            loadRecentActivities();
            
            // 30초마다 데이터 새로고침
            setInterval(() => {
                loadDashboardData();
            }, 30000);
        });
    </script>
</body>
</html> 
