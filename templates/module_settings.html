{% extends "base.html" %}

{% block title %}Î™®Îìà ÏÑ§Ï†ï - {{ module_name }}{% endblock %}

{% block extra_css %}
<style>
.settings-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

.settings-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
    text-align: center;
}

.settings-title {
    font-size: 2rem;
    margin-bottom: 10px;
    font-weight: 700;
}

.settings-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    line-height: 1.6;
}

.settings-content {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 30px;
}

.settings-sidebar {
    background: white;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
    height: fit-content;
}

.settings-sidebar h3 {
    color: #374151;
    margin-bottom: 20px;
    font-size: 1.3rem;
    font-weight: 600;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 10px;
}

.module-info {
    margin-bottom: 25px;
}

.module-info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f3f4f6;
}

.module-info-label {
    font-weight: 600;
    color: #6b7280;
    font-size: 0.9rem;
}

.module-info-value {
    color: #1f2937;
    font-size: 0.9rem;
}

.module-status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-activated {
    background: #dbeafe;
    color: #1e40af;
}

.status-installed {
    background: #fef3c7;
    color: #92400e;
}

.status-deactivated {
    background: #f3f4f6;
    color: #6b7280;
}

.quick-actions {
    margin-bottom: 25px;
}

.quick-action-btn {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    text-align: center;
    font-size: 0.9rem;
    display: block;
}

.quick-action-btn-primary {
    background: #3b82f6;
    color: white;
}

.quick-action-btn-primary:hover {
    background: #2563eb;
}

.quick-action-btn-success {
    background: #10b981;
    color: white;
}

.quick-action-btn-success:hover {
    background: #059669;
}

.quick-action-btn-warning {
    background: #f59e0b;
    color: white;
}

.quick-action-btn-warning:hover {
    background: #d97706;
}

.quick-action-btn-danger {
    background: #ef4444;
    color: white;
}

.quick-action-btn-danger:hover {
    background: #dc2626;
}

.quick-action-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.quick-action-btn-secondary:hover {
    background: #e5e7eb;
}

.settings-main {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
}

.settings-main h3 {
    color: #374151;
    margin-bottom: 25px;
    font-size: 1.5rem;
    font-weight: 600;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 10px;
}

.settings-section {
    margin-bottom: 30px;
}

.settings-section h4 {
    color: #6b7280;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.setting-group {
    margin-bottom: 20px;
}

.setting-label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.setting-description {
    color: #6b7280;
    font-size: 0.8rem;
    margin-bottom: 8px;
    line-height: 1.4;
}

.setting-input {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.setting-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.setting-select {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
    cursor: pointer;
}

.setting-checkbox {
    margin-right: 8px;
}

.setting-checkbox-label {
    font-weight: 500;
    color: #374151;
    cursor: pointer;
}

.setting-textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    min-height: 100px;
    resize: vertical;
    font-family: inherit;
}

.setting-number {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
}

.setting-color {
    width: 50px;
    height: 40px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    cursor: pointer;
}

.setting-radio-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.setting-radio {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.setting-radio:hover {
    background: #f9fafb;
}

.setting-radio input[type="radio"] {
    margin: 0;
}

.setting-radio-label {
    font-weight: 500;
    color: #374151;
    cursor: pointer;
}

.setting-radio-description {
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 2px;
}

.settings-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
}

.action-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
}

.action-btn-primary {
    background: #3b82f6;
    color: white;
}

.action-btn-primary:hover {
    background: #2563eb;
}

.action-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.action-btn-secondary:hover {
    background: #e5e7eb;
}

.action-btn-danger {
    background: #ef4444;
    color: white;
}

.action-btn-danger:hover {
    background: #dc2626;
}

.setting-validation {
    color: #dc2626;
    font-size: 0.8rem;
    margin-top: 5px;
}

.setting-help {
    color: #6b7280;
    font-size: 0.8rem;
    margin-top: 5px;
    line-height: 1.4;
}

.settings-tabs {
    display: flex;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 25px;
}

.settings-tab {
    padding: 12px 20px;
    border: none;
    background: none;
    cursor: pointer;
    font-weight: 600;
    color: #6b7280;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.settings-tab.active {
    color: #3b82f6;
    border-bottom-color: #3b82f6;
}

.settings-tab:hover {
    color: #374151;
}

.settings-tab-content {
    display: none;
}

.settings-tab-content.active {
    display: block;
}

.permissions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.permission-item {
    background: #f8fafc;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
}

.permission-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.permission-name {
    font-weight: 600;
    color: #374151;
    font-size: 0.9rem;
}

.permission-checkbox {
    margin: 0;
}

.permission-description {
    color: #6b7280;
    font-size: 0.8rem;
    line-height: 1.4;
}

.integration-status {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 10px;
}

.integration-status.connected {
    background: #dbeafe;
    color: #1e40af;
}

.integration-status.disconnected {
    background: #fee2e2;
    color: #991b1b;
}

.integration-status.pending {
    background: #fef3c7;
    color: #92400e;
}

.integration-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
}

.integration-icon.connected {
    background: #10b981;
}

.integration-icon.disconnected {
    background: #ef4444;
}

.integration-icon.pending {
    background: #f59e0b;
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f4f6;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
    .settings-content {
        grid-template-columns: 1fr;
    }
    
    .settings-actions {
        flex-direction: column;
    }
    
    .permissions-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <!-- ÏÑ§Ï†ï Ìó§Îçî -->
    <div class="settings-header">
        <h1 class="settings-title">‚öôÔ∏è {{ module_name }} ÏÑ§Ï†ï</h1>
        <p class="settings-subtitle">
            Î™®ÎìàÏùò ÏÑ§Ï†ïÏùÑ Í¥ÄÎ¶¨ÌïòÍ≥† Í∂åÌïúÏùÑ Ï°∞Ï†ïÌïòÏÑ∏Ïöî.<br>
            Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÄ Ï¶âÏãú Ï†ÅÏö©Îê©ÎãàÎã§.
        </p>
    </div>

    <!-- ÏÑ§Ï†ï ÏΩòÌÖêÏ∏† -->
    <div class="settings-content">
        <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
        <div class="settings-sidebar">
            <h3>üìã Î™®Îìà Ï†ïÎ≥¥</h3>
            
            <div class="module-info">
                <div class="module-info-item">
                    <span class="module-info-label">Î™®ÎìàÎ™Ö</span>
                    <span class="module-info-value">{{ module_name }}</span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">Î≤ÑÏ†Ñ</span>
                    <span class="module-info-value">{{ module_version }}</span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">ÏÉÅÌÉú</span>
                    <span class="module-status-badge status-{{ module_status }}">
                        {{ get_status_text(module_status) }}
                    </span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">ÏÑ§ÏπòÏùº</span>
                    <span class="module-info-value">{{ module_installed_at }}</span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">ÌôúÏÑ±ÌôîÏùº</span>
                    <span class="module-info-value">{{ module_activated_at or 'ÎØ∏ÌôúÏÑ±Ìôî' }}</span>
                </div>
            </div>
            
            <h3>üöÄ Îπ†Î•∏ ÏûëÏóÖ</h3>
            
            <div class="quick-actions">
                {% if module_status == 'installed' %}
                    <button class="quick-action-btn quick-action-btn-success" onclick="activateModule()">
                        ÌôúÏÑ±Ìôî
                    </button>
                {% elif module_status == 'activated' %}
                    <button class="quick-action-btn quick-action-btn-warning" onclick="deactivateModule()">
                        ÎπÑÌôúÏÑ±Ìôî
                    </button>
                {% endif %}
                
                <button class="quick-action-btn quick-action-btn-secondary" onclick="runDemo()">
                    Îç∞Î™® Ïã§Ìñâ
                </button>
                
                <button class="quick-action-btn quick-action-btn-secondary" onclick="viewDocumentation()">
                    Î¨∏ÏÑú Î≥¥Í∏∞
                </button>
                
                <button class="quick-action-btn quick-action-btn-danger" onclick="uninstallModule()">
                    Î™®Îìà Ï†úÍ±∞
                </button>
            </div>
        </div>

        <!-- Î©îÏù∏ ÏÑ§Ï†ï ÏòÅÏó≠ -->
        <div class="settings-main">
            <!-- ÏÑ§Ï†ï ÌÉ≠ -->
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="showTab('general')">ÏùºÎ∞ò ÏÑ§Ï†ï</button>
                <button class="settings-tab" onclick="showTab('permissions')">Í∂åÌïú Í¥ÄÎ¶¨</button>
                <button class="settings-tab" onclick="showTab('integrations')">Ïó∞Îèô ÏÑ§Ï†ï</button>
                <button class="settings-tab" onclick="showTab('advanced')">Í≥†Í∏â ÏÑ§Ï†ï</button>
            </div>

            <!-- ÏùºÎ∞ò ÏÑ§Ï†ï ÌÉ≠ -->
            <div id="general-tab" class="settings-tab-content active">
                <h3>ÏùºÎ∞ò ÏÑ§Ï†ï</h3>
                
                <form id="generalSettingsForm">
                    <div class="settings-section">
                        <h4>Í∏∞Î≥∏ ÏÑ§Ï†ï</h4>
                        
                        <div class="setting-group">
                            <label class="setting-label">Î™®Îìà ÌôúÏÑ±Ìôî</label>
                            <div class="setting-description">Ïù¥ Î™®ÎìàÏùÑ ÌôúÏÑ±ÌôîÌïòÏó¨ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ìï©ÎãàÎã§.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="moduleEnabled" 
                                       {% if module_status == 'activated' %}checked{% endif %}>
                                Î™®Îìà ÌôúÏÑ±Ìôî
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ÏûêÎèô ÏãúÏûë</label>
                            <div class="setting-description">ÏãúÏä§ÌÖú ÏãúÏûë Ïãú ÏûêÎèôÏúºÎ°ú Î™®ÎìàÏùÑ ÌôúÏÑ±ÌôîÌï©ÎãàÎã§.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="autoStart" 
                                       {% if settings.get('auto_start', False) %}checked{% endif %}>
                                ÏûêÎèô ÏãúÏûë
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ÎîîÎ≤ÑÍ∑∏ Î™®Îìú</label>
                            <div class="setting-description">ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥Î•º ÌôúÏÑ±ÌôîÌï©ÎãàÎã§.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="debugMode" 
                                       {% if settings.get('debug_mode', False) %}checked{% endif %}>
                                ÎîîÎ≤ÑÍ∑∏ Î™®Îìú
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>ÏïåÎ¶º ÏÑ§Ï†ï</h4>
                        
                        <div class="setting-group">
                            <label class="setting-label">Ïù¥Î©îÏùº ÏïåÎ¶º</label>
                            <div class="setting-description">Ï§ëÏöîÌïú Ïù¥Î≤§Ìä∏Ïóê ÎåÄÌï¥ Ïù¥Î©îÏùº ÏïåÎ¶ºÏùÑ Î∞õÏäµÎãàÎã§.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="emailNotifications" 
                                       {% if settings.get('email_notifications', True) %}checked{% endif %}>
                                Ïù¥Î©îÏùº ÏïåÎ¶º ÌôúÏÑ±Ìôî
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">Ìë∏Ïãú ÏïåÎ¶º</label>
                            <div class="setting-description">Î™®Î∞îÏùº Ïï±ÏúºÎ°ú Ìë∏Ïãú ÏïåÎ¶ºÏùÑ Î∞õÏäµÎãàÎã§.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="pushNotifications" 
                                       {% if settings.get('push_notifications', True) %}checked{% endif %}>
                                Ìë∏Ïãú ÏïåÎ¶º ÌôúÏÑ±Ìôî
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ÏïåÎ¶º ÎπàÎèÑ</label>
                            <div class="setting-description">ÏïåÎ¶ºÏùÑ Î∞õÏùÑ ÎπàÎèÑÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                            <select class="setting-select" id="notificationFrequency">
                                <option value="immediate" {% if settings.get('notification_frequency') == 'immediate' %}selected{% endif %}>Ï¶âÏãú</option>
                                <option value="hourly" {% if settings.get('notification_frequency') == 'hourly' %}selected{% endif %}>ÏãúÍ∞ÑÎ≥Ñ</option>
                                <option value="daily" {% if settings.get('notification_frequency') == 'daily' %}selected{% endif %}>ÏùºÎ≥Ñ</option>
                                <option value="weekly" {% if settings.get('notification_frequency') == 'weekly' %}selected{% endif %}>Ï£ºÎ≥Ñ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï</h4>
                        
                        <div class="setting-group">
                            <label class="setting-label">Îç∞Ïù¥ÌÑ∞ Î≥¥Ï°¥ Í∏∞Í∞Ñ</label>
                            <div class="setting-description">Î™®Îìà Îç∞Ïù¥ÌÑ∞Î•º Î≥¥Ï°¥Ìï† Í∏∞Í∞ÑÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                            <input type="number" class="setting-number" id="dataRetentionDays" 
                                   value="{{ settings.get('data_retention_days', 365) }}" min="1" max="3650">
                            <div class="setting-help">Ïùº Îã®ÏúÑ (1-3650Ïùº)</div>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ÏûêÎèô Î∞±ÏóÖ</label>
                            <div class="setting-description">Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Î•º Î∞±ÏóÖÌï©ÎãàÎã§.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="autoBackup" 
                                       {% if settings.get('auto_backup', True) %}checked{% endif %}>
                                ÏûêÎèô Î∞±ÏóÖ ÌôúÏÑ±Ìôî
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">Î∞±ÏóÖ ÎπàÎèÑ</label>
                            <div class="setting-description">Î∞±ÏóÖÏùÑ ÏàòÌñâÌï† ÎπàÎèÑÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                            <select class="setting-select" id="backupFrequency">
                                <option value="daily" {% if settings.get('backup_frequency') == 'daily' %}selected{% endif %}>ÏùºÎ≥Ñ</option>
                                <option value="weekly" {% if settings.get('backup_frequency') == 'weekly' %}selected{% endif %}>Ï£ºÎ≥Ñ</option>
                                <option value="monthly" {% if settings.get('backup_frequency') == 'monthly' %}selected{% endif %}>ÏõîÎ≥Ñ</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Í∂åÌïú Í¥ÄÎ¶¨ ÌÉ≠ -->
            <div id="permissions-tab" class="settings-tab-content">
                <h3>Í∂åÌïú Í¥ÄÎ¶¨</h3>
                
                <div class="settings-section">
                    <h4>Ïó≠Ìï†Î≥Ñ Í∂åÌïú</h4>
                    <div class="setting-description">Í∞Å Ïó≠Ìï†Ïù¥ Í∞ÄÏßà Ïàò ÏûàÎäî Í∂åÌïúÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                    
                    <div class="permissions-grid" id="permissionsGrid">
                        <!-- Í∂åÌïú Ìï≠Î™©Îì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>

            <!-- Ïó∞Îèô ÏÑ§Ï†ï ÌÉ≠ -->
            <div id="integrations-tab" class="settings-tab-content">
                <h3>Ïó∞Îèô ÏÑ§Ï†ï</h3>
                
                <div class="settings-section">
                    <h4>Ï§ëÏïô Îç∞Ïù¥ÌÑ∞ Ïó∞Îèô</h4>
                    
                    <div class="integration-status connected">
                        <div class="integration-icon connected"></div>
                        <div>
                            <strong>Ï§ëÏïô Îç∞Ïù¥ÌÑ∞ Î†àÏù¥Ïñ¥</strong>
                            <div>Ïó∞ÎèôÎê® - Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ï§ë</div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ÎèôÍ∏∞Ìôî ÎπàÎèÑ</label>
                        <div class="setting-description">Ï§ëÏïô Îç∞Ïù¥ÌÑ∞ÏôÄ ÎèôÍ∏∞ÌôîÌï† ÎπàÎèÑÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <select class="setting-select" id="syncFrequency">
                            <option value="realtime">Ïã§ÏãúÍ∞Ñ</option>
                            <option value="5min">5Î∂ÑÎßàÎã§</option>
                            <option value="15min">15Î∂ÑÎßàÎã§</option>
                            <option value="1hour">1ÏãúÍ∞ÑÎßàÎã§</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>ÌÜµÌï© Ïó∞Îèô ÏãúÏä§ÌÖú</h4>
                    
                    <div class="integration-status connected">
                        <div class="integration-icon connected"></div>
                        <div>
                            <strong>ÌÜµÌï© Ïó∞Îèô ÏãúÏä§ÌÖú</strong>
                            <div>Ïó∞ÎèôÎê® - Ïù¥Î≤§Ìä∏ Í∏∞Î∞ò Ï≤òÎ¶¨ Ï§ë</div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨</label>
                        <div class="setting-description">Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ Î∞©ÏãùÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <div class="setting-radio-group">
                            <label class="setting-radio">
                                <input type="radio" name="eventProcessing" value="immediate" checked>
                                <div>
                                    <div class="setting-radio-label">Ï¶âÏãú Ï≤òÎ¶¨</div>
                                    <div class="setting-radio-description">Ïù¥Î≤§Ìä∏ Î∞úÏÉù Ïãú Ï¶âÏãú Ï≤òÎ¶¨Ìï©ÎãàÎã§.</div>
                                </div>
                            </label>
                            <label class="setting-radio">
                                <input type="radio" name="eventProcessing" value="batch">
                                <div>
                                    <div class="setting-radio-label">Î∞∞Ïπò Ï≤òÎ¶¨</div>
                                    <div class="setting-radio-description">ÏùºÏ†ï ÏãúÍ∞ÑÎßàÎã§ Î∞∞ÏπòÎ°ú Ï≤òÎ¶¨Ìï©ÎãàÎã§.</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Í≥†Í∏â ÏÑ§Ï†ï ÌÉ≠ -->
            <div id="advanced-tab" class="settings-tab-content">
                <h3>Í≥†Í∏â ÏÑ§Ï†ï</h3>
                
                <div class="settings-section">
                    <h4>ÏÑ±Îä• ÏÑ§Ï†ï</h4>
                    
                    <div class="setting-group">
                        <label class="setting-label">Ï∫êÏãú TTL</label>
                        <div class="setting-description">Ï∫êÏãú Îç∞Ïù¥ÌÑ∞Ïùò Ïú†Ìö® ÏãúÍ∞ÑÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <input type="number" class="setting-number" id="cacheTTL" 
                               value="{{ settings.get('cache_ttl', 300) }}" min="60" max="3600">
                        <div class="setting-help">Ï¥à Îã®ÏúÑ (60-3600Ï¥à)</div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ÏµúÎåÄ ÎèôÏãú Ï≤òÎ¶¨</label>
                        <div class="setting-description">ÎèôÏãúÏóê Ï≤òÎ¶¨Ìï† Ïàò ÏûàÎäî ÏµúÎåÄ ÏûëÏóÖ ÏàòÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <input type="number" class="setting-number" id="maxConcurrent" 
                               value="{{ settings.get('max_concurrent', 10) }}" min="1" max="100">
                        <div class="setting-help">1-100Í∞ú</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Î°úÍπÖ ÏÑ§Ï†ï</h4>
                    
                    <div class="setting-group">
                        <label class="setting-label">Î°úÍ∑∏ Î†àÎ≤®</label>
                        <div class="setting-description">Î°úÍ∑∏Ïùò ÏÉÅÏÑ∏ ÏàòÏ§ÄÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <select class="setting-select" id="logLevel">
                            <option value="DEBUG" {% if settings.get('log_level') == 'DEBUG' %}selected{% endif %}>DEBUG</option>
                            <option value="INFO" {% if settings.get('log_level') == 'INFO' %}selected{% endif %}>INFO</option>
                            <option value="WARNING" {% if settings.get('log_level') == 'WARNING' %}selected{% endif %}>WARNING</option>
                            <option value="ERROR" {% if settings.get('log_level') == 'ERROR' %}selected{% endif %}>ERROR</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">Î°úÍ∑∏ Î≥¥Ï°¥ Í∏∞Í∞Ñ</label>
                        <div class="setting-description">Î°úÍ∑∏ ÌååÏùºÏùÑ Î≥¥Ï°¥Ìï† Í∏∞Í∞ÑÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <input type="number" class="setting-number" id="logRetentionDays" 
                               value="{{ settings.get('log_retention_days', 30) }}" min="1" max="365">
                        <div class="setting-help">Ïùº Îã®ÏúÑ (1-365Ïùº)</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Î≥¥Ïïà ÏÑ§Ï†ï</h4>
                    
                    <div class="setting-group">
                        <label class="setting-label">API ÌÇ§</label>
                        <div class="setting-description">Ïô∏Î∂Ä API Ïó∞ÎèôÏùÑ ÏúÑÌïú ÌÇ§Î•º ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <input type="password" class="setting-input" id="apiKey" 
                               value="{{ settings.get('api_key', '') }}" placeholder="API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">IP ÌôîÏù¥Ìä∏Î¶¨Ïä§Ìä∏</label>
                        <div class="setting-description">Ï†ëÍ∑ºÏùÑ ÌóàÏö©Ìï† IP Ï£ºÏÜåÎ•º ÏÑ§Ï†ïÌï©ÎãàÎã§.</div>
                        <textarea class="setting-textarea" id="ipWhitelist" 
                                  placeholder="Ìïú Ï§ÑÏóê ÌïòÎÇòÏî© IP Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">{{ settings.get('ip_whitelist', '') }}</textarea>
                    </div>
                </div>
            </div>

            <!-- ÏÑ§Ï†ï Ïï°ÏÖò Î≤ÑÌäº -->
            <div class="settings-actions">
                <button class="action-btn action-btn-primary" onclick="saveSettings()">
                    ÏÑ§Ï†ï Ï†ÄÏû•
                </button>
                <button class="action-btn action-btn-secondary" onclick="resetSettings()">
                    Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõê
                </button>
                <button class="action-btn action-btn-secondary" onclick="exportSettings()">
                    ÏÑ§Ï†ï ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>

<script type="text/javascript">
    // Jinja2Ïùò tojson ÌïÑÌÑ∞Î•º ÏÇ¨Ïö©Ìï† Îïå, ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ Í∞ùÏ≤¥Î°ú ÏïàÏ†ÑÌïòÍ≤å Î≥ÄÌôòÌïòÎ†§Î©¥ Î∞òÎìúÏãú Ï§ëÍ¥ÑÌò∏({{ }})Î•º Îî∞Ïò¥ÌëúÎ°ú Í∞êÏã∏Ïïº Ìï©ÎãàÎã§.
    // window Í∞ùÏ≤¥Ïóê Ìï†ÎãπÌïòÎ©¥ Ï†ÑÏó≠ Î≥ÄÏàò Ï∂©ÎèåÏùÑ Î∞©ÏßÄÌï† Ïàò ÏûàÏäµÎãàÎã§. (Ï¥àÎ≥¥ÏûêÏóêÍ≤å Ï∂îÏ≤ú)
    window.currentSettings = {{ settings | tojson | safe }}; // noqa
    window.originalSettings = {{ settings | tojson | safe }}; // noqa
</script>

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
    document.addEventListener('DOMContentLoaded', function() {
    loadPermissions();
    setupEventListeners();
});

// ÌÉ≠ Ï†ÑÌôò
function showTab(tabName) {
    // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.settings-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
    document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
    document.getElementById(`${tabName}-tab`).classList.add('active');
}

// Í∂åÌïú Î°úÎìú
function loadPermissions() {
    const permissions = [
        {
            name: 'Î™®Îìà Í¥ÄÎ¶¨',
            description: 'Î™®Îìà ÏÑ§Ïπò, ÌôúÏÑ±Ìôî, ÎπÑÌôúÏÑ±Ìôî, Ï†úÍ±∞',
            roles: ['system_admin', 'brand_admin']
        },
        {
            name: 'ÏÑ§Ï†ï Í¥ÄÎ¶¨',
            description: 'Î™®Îìà ÏÑ§Ï†ï Î≥ÄÍ≤Ω Î∞è Í¥ÄÎ¶¨',
            roles: ['system_admin', 'brand_admin', 'branch_admin']
        },
        {
            name: 'Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå',
            description: 'Î™®Îìà Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Î∞è Î∂ÑÏÑù',
            roles: ['system_admin', 'brand_admin', 'branch_admin', 'store_manager']
        },
        {
            name: 'Îç∞Ïù¥ÌÑ∞ ÏàòÏ†ï',
            description: 'Î™®Îìà Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±, ÏàòÏ†ï, ÏÇ≠Ï†ú',
            roles: ['system_admin', 'brand_admin', 'branch_admin']
        },
        {
            name: 'Î≥¥Í≥†ÏÑú ÏÉùÏÑ±',
            description: 'Î™®Îìà Í¥ÄÎ†® Î≥¥Í≥†ÏÑú ÏÉùÏÑ± Î∞è ÎÇ¥Î≥¥ÎÇ¥Í∏∞',
            roles: ['system_admin', 'brand_admin', 'branch_admin']
        },
        {
            name: 'ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨',
            description: 'Î™®Îìà ÏÇ¨Ïö©Ïûê Í∂åÌïú Í¥ÄÎ¶¨',
            roles: ['system_admin', 'brand_admin']
        }
    ];
    
    const grid = document.getElementById('permissionsGrid');
    grid.innerHTML = '';
    
    permissions.forEach(permission => {
        const item = document.createElement('div');
        item.className = 'permission-item';
        
        item.innerHTML = `
            <div class="permission-header">
                <div class="permission-name">${permission.name}</div>
                <input type="checkbox" class="permission-checkbox" 
                       id="perm_${permission.name.replace(/\s+/g, '_')}"
                       ${permission.roles.includes('{{ current_user.role }}') ? 'checked' : ''}>
            </div>
            <div class="permission-description">${permission.description}</div>
        `;
        
        grid.appendChild(item);
    });
}

// ÏÑ§Ï†ï Ï†ÄÏû•
function saveSettings() {
    showLoading();
    
    const settings = collectSettings();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/settings`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ÏÑ§Ï†ïÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            currentSettings = settings;
        } else {
            alert('ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®: ' + data.error);
        }
    })
    .catch(error => {
        console.error('ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò:', error);
        alert('ÏÑ§Ï†ï Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    })
    .finally(() => {
        hideLoading();
    });
}

// ÏÑ§Ï†ï ÏàòÏßë
function collectSettings() {
    const settings = {};
    
    // ÏùºÎ∞ò ÏÑ§Ï†ï
    settings.module_enabled = document.getElementById('moduleEnabled').checked;
    settings.auto_start = document.getElementById('autoStart').checked;
    settings.debug_mode = document.getElementById('debugMode').checked;
    settings.email_notifications = document.getElementById('emailNotifications').checked;
    settings.push_notifications = document.getElementById('pushNotifications').checked;
    settings.notification_frequency = document.getElementById('notificationFrequency').value;
    settings.data_retention_days = parseInt(document.getElementById('dataRetentionDays').value);
    settings.auto_backup = document.getElementById('autoBackup').checked;
    settings.backup_frequency = document.getElementById('backupFrequency').value;
    
    // Í≥†Í∏â ÏÑ§Ï†ï
    settings.cache_ttl = parseInt(document.getElementById('cacheTTL').value);
    settings.max_concurrent = parseInt(document.getElementById('maxConcurrent').value);
    settings.log_level = document.getElementById('logLevel').value;
    settings.log_retention_days = parseInt(document.getElementById('logRetentionDays').value);
    settings.api_key = document.getElementById('apiKey').value;
    settings.ip_whitelist = document.getElementById('ipWhitelist').value;
    
    return settings;
}

// ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî
function resetSettings() {
    if (!confirm('Î™®Îì† ÏÑ§Ï†ïÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõêÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
    
    // Ìèº Ï¥àÍ∏∞Ìôî
    document.getElementById('generalSettingsForm').reset();
    
    // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
    document.getElementById('dataRetentionDays').value = 365;
    document.getElementById('cacheTTL').value = 300;
    document.getElementById('maxConcurrent').value = 10;
    document.getElementById('logRetentionDays').value = 30;
    
    alert('ÏÑ§Ï†ïÏù¥ Í∏∞Î≥∏Í∞íÏúºÎ°ú Î≥µÏõêÎêòÏóàÏäµÎãàÎã§.');
}

// ÏÑ§Ï†ï ÎÇ¥Î≥¥ÎÇ¥Í∏∞
function exportSettings() {
    const settings = collectSettings();
    const dataStr = JSON.stringify(settings, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `{{ module_id }}_settings.json`;
    link.click();
}

// Î™®Îìà ÌôúÏÑ±Ìôî
function activateModule() {
    if (!confirm('Ïù¥ Î™®ÎìàÏùÑ ÌôúÏÑ±ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
    
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/activate`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('ÌôúÏÑ±Ìôî Ïã§Ìå®: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Î™®Îìà ÌôúÏÑ±Ìôî Ïò§Î•ò:', error);
        alert('Î™®Îìà ÌôúÏÑ±Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    })
    .finally(() => {
        hideLoading();
    });
}

// Î™®Îìà ÎπÑÌôúÏÑ±Ìôî
function deactivateModule() {
    if (!confirm('Ïù¥ Î™®ÎìàÏùÑ ÎπÑÌôúÏÑ±ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
    
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/deactivate`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('ÎπÑÌôúÏÑ±Ìôî Ïã§Ìå®: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Î™®Îìà ÎπÑÌôúÏÑ±Ìôî Ïò§Î•ò:', error);
        alert('Î™®Îìà ÎπÑÌôúÏÑ±Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    })
    .finally(() => {
        hideLoading();
    });
}

// Î™®Îìà Ï†úÍ±∞
function uninstallModule() {
    if (!confirm('Ïù¥ Î™®ÎìàÏùÑ Ï†úÍ±∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) return;
    
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/uninstall`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            window.location.href = '/module-marketplace';
        } else {
            alert('Ï†úÍ±∞ Ïã§Ìå®: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Î™®Îìà Ï†úÍ±∞ Ïò§Î•ò:', error);
        alert('Î™®Îìà Ï†úÍ±∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    })
    .finally(() => {
        hideLoading();
    });
}

// Îç∞Î™® Ïã§Ìñâ
function runDemo() {
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/demo`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            } else {
                alert('Îç∞Î™® Ïã§Ìñâ Ïã§Ìå®: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Îç∞Î™® Ïã§Ìñâ Ïò§Î•ò:', error);
            alert('Îç∞Î™® Ïã§Ìñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        })
        .finally(() => {
            hideLoading();
        });
}

// Î¨∏ÏÑú Î≥¥Í∏∞
function viewDocumentation() {
    window.open('/docs/modules/{{ module_id }}', '_blank');
}

// Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
function setupEventListeners() {
    // ÏÑ§Ï†ï Î≥ÄÍ≤Ω Í∞êÏßÄ
    document.querySelectorAll('input, select, textarea').forEach(element => {
        element.addEventListener('change', function() {
            // ÏÑ§Ï†ïÏù¥ Î≥ÄÍ≤ΩÎêòÏóàÏùåÏùÑ ÌëúÏãú
            console.log('ÏÑ§Ï†ï Î≥ÄÍ≤ΩÎê®:', this.id, this.value);
        });
    });
}

// Î°úÎî© ÌëúÏãú/Ïà®ÍπÄ
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}
</script>
{% endblock %} 