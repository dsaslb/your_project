{% extends "base.html" %}

{% block title %}ëª¨ë“ˆ ì„¤ì • - {{ module_name }}{% endblock %}

{% block extra_css %}
<style>
.settings-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

.settings-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
    text-align: center;
}

.settings-title {
    font-size: 2rem;
    margin-bottom: 10px;
    font-weight: 700;
}

.settings-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    line-height: 1.6;
}

.settings-content {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 30px;
}

.settings-sidebar {
    background: white;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
    height: fit-content;
}

.settings-sidebar h3 {
    color: #374151;
    margin-bottom: 20px;
    font-size: 1.3rem;
    font-weight: 600;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 10px;
}

.module-info {
    margin-bottom: 25px;
}

.module-info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f3f4f6;
}

.module-info-label {
    font-weight: 600;
    color: #6b7280;
    font-size: 0.9rem;
}

.module-info-value {
    color: #1f2937;
    font-size: 0.9rem;
}

.module-status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-activated {
    background: #dbeafe;
    color: #1e40af;
}

.status-installed {
    background: #fef3c7;
    color: #92400e;
}

.status-deactivated {
    background: #f3f4f6;
    color: #6b7280;
}

.quick-actions {
    margin-bottom: 25px;
}

.quick-action-btn {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    text-align: center;
    font-size: 0.9rem;
    display: block;
}

.quick-action-btn-primary {
    background: #3b82f6;
    color: white;
}

.quick-action-btn-primary:hover {
    background: #2563eb;
}

.quick-action-btn-success {
    background: #10b981;
    color: white;
}

.quick-action-btn-success:hover {
    background: #059669;
}

.quick-action-btn-warning {
    background: #f59e0b;
    color: white;
}

.quick-action-btn-warning:hover {
    background: #d97706;
}

.quick-action-btn-danger {
    background: #ef4444;
    color: white;
}

.quick-action-btn-danger:hover {
    background: #dc2626;
}

.quick-action-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.quick-action-btn-secondary:hover {
    background: #e5e7eb;
}

.settings-main {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
}

.settings-main h3 {
    color: #374151;
    margin-bottom: 25px;
    font-size: 1.5rem;
    font-weight: 600;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 10px;
}

.settings-section {
    margin-bottom: 30px;
}

.settings-section h4 {
    color: #6b7280;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.setting-group {
    margin-bottom: 20px;
}

.setting-label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.setting-description {
    color: #6b7280;
    font-size: 0.8rem;
    margin-bottom: 8px;
    line-height: 1.4;
}

.setting-input {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.2s;
}

.setting-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.setting-select {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    background: white;
    cursor: pointer;
}

.setting-checkbox {
    margin-right: 8px;
}

.setting-checkbox-label {
    font-weight: 500;
    color: #374151;
    cursor: pointer;
}

.setting-textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    min-height: 100px;
    resize: vertical;
    font-family: inherit;
}

.setting-number {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
}

.setting-color {
    width: 50px;
    height: 40px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    cursor: pointer;
}

.setting-radio-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.setting-radio {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.setting-radio:hover {
    background: #f9fafb;
}

.setting-radio input[type="radio"] {
    margin: 0;
}

.setting-radio-label {
    font-weight: 500;
    color: #374151;
    cursor: pointer;
}

.setting-radio-description {
    font-size: 0.8rem;
    color: #6b7280;
    margin-top: 2px;
}

.settings-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
}

.action-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
}

.action-btn-primary {
    background: #3b82f6;
    color: white;
}

.action-btn-primary:hover {
    background: #2563eb;
}

.action-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.action-btn-secondary:hover {
    background: #e5e7eb;
}

.action-btn-danger {
    background: #ef4444;
    color: white;
}

.action-btn-danger:hover {
    background: #dc2626;
}

.setting-validation {
    color: #dc2626;
    font-size: 0.8rem;
    margin-top: 5px;
}

.setting-help {
    color: #6b7280;
    font-size: 0.8rem;
    margin-top: 5px;
    line-height: 1.4;
}

.settings-tabs {
    display: flex;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 25px;
}

.settings-tab {
    padding: 12px 20px;
    border: none;
    background: none;
    cursor: pointer;
    font-weight: 600;
    color: #6b7280;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.settings-tab.active {
    color: #3b82f6;
    border-bottom-color: #3b82f6;
}

.settings-tab:hover {
    color: #374151;
}

.settings-tab-content {
    display: none;
}

.settings-tab-content.active {
    display: block;
}

.permissions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.permission-item {
    background: #f8fafc;
    padding: 15px;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
}

.permission-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.permission-name {
    font-weight: 600;
    color: #374151;
    font-size: 0.9rem;
}

.permission-checkbox {
    margin: 0;
}

.permission-description {
    color: #6b7280;
    font-size: 0.8rem;
    line-height: 1.4;
}

.integration-status {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 10px;
}

.integration-status.connected {
    background: #dbeafe;
    color: #1e40af;
}

.integration-status.disconnected {
    background: #fee2e2;
    color: #991b1b;
}

.integration-status.pending {
    background: #fef3c7;
    color: #92400e;
}

.integration-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
}

.integration-icon.connected {
    background: #10b981;
}

.integration-icon.disconnected {
    background: #ef4444;
}

.integration-icon.pending {
    background: #f59e0b;
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f4f6;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
    .settings-content {
        grid-template-columns: 1fr;
    }
    
    .settings-actions {
        flex-direction: column;
    }
    
    .permissions-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <!-- ì„¤ì • í—¤ë” -->
    <div class="settings-header">
        <h1 class="settings-title">âš™ï¸ {{ module_name }} ì„¤ì •</h1>
        <p class="settings-subtitle">
            ëª¨ë“ˆì˜ ì„¤ì •ì„ ê´€ë¦¬í•˜ê³  ê¶Œí•œì„ ì¡°ì •í•˜ì„¸ìš”.<br>
            ë³€ê²½ì‚¬í•­ì€ ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤.
        </p>
    </div>

    <!-- ì„¤ì • ì½˜í…ì¸  -->
    <div class="settings-content">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="settings-sidebar">
            <h3>ğŸ“‹ ëª¨ë“ˆ ì •ë³´</h3>
            
            <div class="module-info">
                <div class="module-info-item">
                    <span class="module-info-label">ëª¨ë“ˆëª…</span>
                    <span class="module-info-value">{{ module_name }}</span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">ë²„ì „</span>
                    <span class="module-info-value">{{ module_version }}</span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">ìƒíƒœ</span>
                    <span class="module-status-badge status-{{ module_status }}">
                        {{ get_status_text(module_status) }}
                    </span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">ì„¤ì¹˜ì¼</span>
                    <span class="module-info-value">{{ module_installed_at }}</span>
                </div>
                <div class="module-info-item">
                    <span class="module-info-label">í™œì„±í™”ì¼</span>
                    <span class="module-info-value">{{ module_activated_at or 'ë¯¸í™œì„±í™”' }}</span>
                </div>
            </div>
            
            <h3>ğŸš€ ë¹ ë¥¸ ì‘ì—…</h3>
            
            <div class="quick-actions">
                {% if module_status == 'installed' %}
                    <button class="quick-action-btn quick-action-btn-success" onclick="activateModule()">
                        í™œì„±í™”
                    </button>
                {% elif module_status == 'activated' %}
                    <button class="quick-action-btn quick-action-btn-warning" onclick="deactivateModule()">
                        ë¹„í™œì„±í™”
                    </button>
                {% endif %}
                
                <button class="quick-action-btn quick-action-btn-secondary" onclick="runDemo()">
                    ë°ëª¨ ì‹¤í–‰
                </button>
                
                <button class="quick-action-btn quick-action-btn-secondary" onclick="viewDocumentation()">
                    ë¬¸ì„œ ë³´ê¸°
                </button>
                
                <button class="quick-action-btn quick-action-btn-danger" onclick="uninstallModule()">
                    ëª¨ë“ˆ ì œê±°
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ì„¤ì • ì˜ì—­ -->
        <div class="settings-main">
            <!-- ì„¤ì • íƒ­ -->
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="showTab('general')">ì¼ë°˜ ì„¤ì •</button>
                <button class="settings-tab" onclick="showTab('permissions')">ê¶Œí•œ ê´€ë¦¬</button>
                <button class="settings-tab" onclick="showTab('integrations')">ì—°ë™ ì„¤ì •</button>
                <button class="settings-tab" onclick="showTab('advanced')">ê³ ê¸‰ ì„¤ì •</button>
            </div>

            <!-- ì¼ë°˜ ì„¤ì • íƒ­ -->
            <div id="general-tab" class="settings-tab-content active">
                <h3>ì¼ë°˜ ì„¤ì •</h3>
                
                <form id="generalSettingsForm">
                    <div class="settings-section">
                        <h4>ê¸°ë³¸ ì„¤ì •</h4>
                        
                        <div class="setting-group">
                            <label class="setting-label">ëª¨ë“ˆ í™œì„±í™”</label>
                            <div class="setting-description">ì´ ëª¨ë“ˆì„ í™œì„±í™”í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="moduleEnabled" 
                                       {% if module_status == 'activated' %}checked{% endif %}>
                                ëª¨ë“ˆ í™œì„±í™”
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ìë™ ì‹œì‘</label>
                            <div class="setting-description">ì‹œìŠ¤í…œ ì‹œì‘ ì‹œ ìë™ìœ¼ë¡œ ëª¨ë“ˆì„ í™œì„±í™”í•©ë‹ˆë‹¤.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="autoStart" 
                                       {% if settings.get('auto_start', False) %}checked{% endif %}>
                                ìë™ ì‹œì‘
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ë””ë²„ê·¸ ëª¨ë“œ</label>
                            <div class="setting-description">ë””ë²„ê·¸ ì •ë³´ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="debugMode" 
                                       {% if settings.get('debug_mode', False) %}checked{% endif %}>
                                ë””ë²„ê·¸ ëª¨ë“œ
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>ì•Œë¦¼ ì„¤ì •</h4>
                        
                        <div class="setting-group">
                            <label class="setting-label">ì´ë©”ì¼ ì•Œë¦¼</label>
                            <div class="setting-description">ì¤‘ìš”í•œ ì´ë²¤íŠ¸ì— ëŒ€í•´ ì´ë©”ì¼ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="emailNotifications" 
                                       {% if settings.get('email_notifications', True) %}checked{% endif %}>
                                ì´ë©”ì¼ ì•Œë¦¼ í™œì„±í™”
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">í‘¸ì‹œ ì•Œë¦¼</label>
                            <div class="setting-description">ëª¨ë°”ì¼ ì•±ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="pushNotifications" 
                                       {% if settings.get('push_notifications', True) %}checked{% endif %}>
                                í‘¸ì‹œ ì•Œë¦¼ í™œì„±í™”
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ì•Œë¦¼ ë¹ˆë„</label>
                            <div class="setting-description">ì•Œë¦¼ì„ ë°›ì„ ë¹ˆë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                            <select class="setting-select" id="notificationFrequency">
                                <option value="immediate" {% if settings.get('notification_frequency') == 'immediate' %}selected{% endif %}>ì¦‰ì‹œ</option>
                                <option value="hourly" {% if settings.get('notification_frequency') == 'hourly' %}selected{% endif %}>ì‹œê°„ë³„</option>
                                <option value="daily" {% if settings.get('notification_frequency') == 'daily' %}selected{% endif %}>ì¼ë³„</option>
                                <option value="weekly" {% if settings.get('notification_frequency') == 'weekly' %}selected{% endif %}>ì£¼ë³„</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>ë°ì´í„° ì„¤ì •</h4>
                        
                        <div class="setting-group">
                            <label class="setting-label">ë°ì´í„° ë³´ì¡´ ê¸°ê°„</label>
                            <div class="setting-description">ëª¨ë“ˆ ë°ì´í„°ë¥¼ ë³´ì¡´í•  ê¸°ê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                            <input type="number" class="setting-number" id="dataRetentionDays" 
                                   value="{{ settings.get('data_retention_days', 365) }}" min="1" max="3650">
                            <div class="setting-help">ì¼ ë‹¨ìœ„ (1-3650ì¼)</div>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ìë™ ë°±ì—…</label>
                            <div class="setting-description">ì •ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°±ì—…í•©ë‹ˆë‹¤.</div>
                            <label class="setting-checkbox-label">
                                <input type="checkbox" class="setting-checkbox" id="autoBackup" 
                                       {% if settings.get('auto_backup', True) %}checked{% endif %}>
                                ìë™ ë°±ì—… í™œì„±í™”
                            </label>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">ë°±ì—… ë¹ˆë„</label>
                            <div class="setting-description">ë°±ì—…ì„ ìˆ˜í–‰í•  ë¹ˆë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                            <select class="setting-select" id="backupFrequency">
                                <option value="daily" {% if settings.get('backup_frequency') == 'daily' %}selected{% endif %}>ì¼ë³„</option>
                                <option value="weekly" {% if settings.get('backup_frequency') == 'weekly' %}selected{% endif %}>ì£¼ë³„</option>
                                <option value="monthly" {% if settings.get('backup_frequency') == 'monthly' %}selected{% endif %}>ì›”ë³„</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>

            <!-- ê¶Œí•œ ê´€ë¦¬ íƒ­ -->
            <div id="permissions-tab" class="settings-tab-content">
                <h3>ê¶Œí•œ ê´€ë¦¬</h3>
                
                <div class="settings-section">
                    <h4>ì—­í• ë³„ ê¶Œí•œ</h4>
                    <div class="setting-description">ê° ì—­í• ì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                    
                    <div class="permissions-grid" id="permissionsGrid">
                        <!-- ê¶Œí•œ í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>

            <!-- ì—°ë™ ì„¤ì • íƒ­ -->
            <div id="integrations-tab" class="settings-tab-content">
                <h3>ì—°ë™ ì„¤ì •</h3>
                
                <div class="settings-section">
                    <h4>ì¤‘ì•™ ë°ì´í„° ì—°ë™</h4>
                    
                    <div class="integration-status connected">
                        <div class="integration-icon connected"></div>
                        <div>
                            <strong>ì¤‘ì•™ ë°ì´í„° ë ˆì´ì–´</strong>
                            <div>ì—°ë™ë¨ - ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì¤‘</div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ë™ê¸°í™” ë¹ˆë„</label>
                        <div class="setting-description">ì¤‘ì•™ ë°ì´í„°ì™€ ë™ê¸°í™”í•  ë¹ˆë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <select class="setting-select" id="syncFrequency">
                            <option value="realtime">ì‹¤ì‹œê°„</option>
                            <option value="5min">5ë¶„ë§ˆë‹¤</option>
                            <option value="15min">15ë¶„ë§ˆë‹¤</option>
                            <option value="1hour">1ì‹œê°„ë§ˆë‹¤</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>í†µí•© ì—°ë™ ì‹œìŠ¤í…œ</h4>
                    
                    <div class="integration-status connected">
                        <div class="integration-icon connected"></div>
                        <div>
                            <strong>í†µí•© ì—°ë™ ì‹œìŠ¤í…œ</strong>
                            <div>ì—°ë™ë¨ - ì´ë²¤íŠ¸ ê¸°ë°˜ ì²˜ë¦¬ ì¤‘</div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ì´ë²¤íŠ¸ ì²˜ë¦¬</label>
                        <div class="setting-description">ì´ë²¤íŠ¸ ì²˜ë¦¬ ë°©ì‹ì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <div class="setting-radio-group">
                            <label class="setting-radio">
                                <input type="radio" name="eventProcessing" value="immediate" checked>
                                <div>
                                    <div class="setting-radio-label">ì¦‰ì‹œ ì²˜ë¦¬</div>
                                    <div class="setting-radio-description">ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì¦‰ì‹œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</div>
                                </div>
                            </label>
                            <label class="setting-radio">
                                <input type="radio" name="eventProcessing" value="batch">
                                <div>
                                    <div class="setting-radio-label">ë°°ì¹˜ ì²˜ë¦¬</div>
                                    <div class="setting-radio-description">ì¼ì • ì‹œê°„ë§ˆë‹¤ ë°°ì¹˜ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³ ê¸‰ ì„¤ì • íƒ­ -->
            <div id="advanced-tab" class="settings-tab-content">
                <h3>ê³ ê¸‰ ì„¤ì •</h3>
                
                <div class="settings-section">
                    <h4>ì„±ëŠ¥ ì„¤ì •</h4>
                    
                    <div class="setting-group">
                        <label class="setting-label">ìºì‹œ TTL</label>
                        <div class="setting-description">ìºì‹œ ë°ì´í„°ì˜ ìœ íš¨ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <input type="number" class="setting-number" id="cacheTTL" 
                               value="{{ settings.get('cache_ttl', 300) }}" min="60" max="3600">
                        <div class="setting-help">ì´ˆ ë‹¨ìœ„ (60-3600ì´ˆ)</div>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ìµœëŒ€ ë™ì‹œ ì²˜ë¦¬</label>
                        <div class="setting-description">ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ì‘ì—… ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <input type="number" class="setting-number" id="maxConcurrent" 
                               value="{{ settings.get('max_concurrent', 10) }}" min="1" max="100">
                        <div class="setting-help">1-100ê°œ</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>ë¡œê¹… ì„¤ì •</h4>
                    
                    <div class="setting-group">
                        <label class="setting-label">ë¡œê·¸ ë ˆë²¨</label>
                        <div class="setting-description">ë¡œê·¸ì˜ ìƒì„¸ ìˆ˜ì¤€ì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <select class="setting-select" id="logLevel">
                            <option value="DEBUG" {% if settings.get('log_level') == 'DEBUG' %}selected{% endif %}>DEBUG</option>
                            <option value="INFO" {% if settings.get('log_level') == 'INFO' %}selected{% endif %}>INFO</option>
                            <option value="WARNING" {% if settings.get('log_level') == 'WARNING' %}selected{% endif %}>WARNING</option>
                            <option value="ERROR" {% if settings.get('log_level') == 'ERROR' %}selected{% endif %}>ERROR</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">ë¡œê·¸ ë³´ì¡´ ê¸°ê°„</label>
                        <div class="setting-description">ë¡œê·¸ íŒŒì¼ì„ ë³´ì¡´í•  ê¸°ê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <input type="number" class="setting-number" id="logRetentionDays" 
                               value="{{ settings.get('log_retention_days', 30) }}" min="1" max="365">
                        <div class="setting-help">ì¼ ë‹¨ìœ„ (1-365ì¼)</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>ë³´ì•ˆ ì„¤ì •</h4>
                    
                    <div class="setting-group">
                        <label class="setting-label">API í‚¤</label>
                        <div class="setting-description">ì™¸ë¶€ API ì—°ë™ì„ ìœ„í•œ í‚¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <input type="password" class="setting-input" id="apiKey" 
                               value="{{ settings.get('api_key', '') }}" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="setting-group">
                        <label class="setting-label">IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</label>
                        <div class="setting-description">ì ‘ê·¼ì„ í—ˆìš©í•  IP ì£¼ì†Œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</div>
                        <textarea class="setting-textarea" id="ipWhitelist" 
                                  placeholder="í•œ ì¤„ì— í•˜ë‚˜ì”© IP ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">{{ settings.get('ip_whitelist', '') }}</textarea>
                    </div>
                </div>
            </div>

            <!-- ì„¤ì • ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="settings-actions">
                <button class="action-btn action-btn-primary" onclick="saveSettings()">
                    ì„¤ì • ì €ì¥
                </button>
                <button class="action-btn action-btn-secondary" onclick="resetSettings()">
                    ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
                </button>
                <button class="action-btn action-btn-secondary" onclick="exportSettings()">
                    ì„¤ì • ë‚´ë³´ë‚´ê¸°
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner"></div>
</div>

<script type="text/javascript">
    // Jinja2ì˜ tojson í•„í„°ë¥¼ ì‚¬ìš©í•  ë•Œ, ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¡œ ì•ˆì „í•˜ê²Œ ë³€í™˜í•˜ë ¤ë©´ ë°˜ë“œì‹œ ì¤‘ê´„í˜¸({{ }})ë¥¼ ë”°ì˜´í‘œë¡œ ê°ì‹¸ì•¼ í•©ë‹ˆë‹¤.
    // window ê°ì²´ì— í• ë‹¹í•˜ë©´ ì „ì—­ ë³€ìˆ˜ ì¶©ëŒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì´ˆë³´ìì—ê²Œ ì¶”ì²œ)
    window.currentSettings = {{ settings | tojson | safe }}; // noqa
    window.originalSettings = {{ settings | tojson | safe }}; // noqa
</script>

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
    loadPermissions();
    setupEventListeners();
});

// íƒ­ ì „í™˜
function showTab(tabName) {
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.settings-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // ì„ íƒëœ íƒ­ í™œì„±í™”
    document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
    document.getElementById(`${tabName}-tab`).classList.add('active');
}

// ê¶Œí•œ ë¡œë“œ
function loadPermissions() {
    const permissions = [
        {
            name: 'ëª¨ë“ˆ ê´€ë¦¬',
            description: 'ëª¨ë“ˆ ì„¤ì¹˜, í™œì„±í™”, ë¹„í™œì„±í™”, ì œê±°',
            roles: ['system_admin', 'brand_admin']
        },
        {
            name: 'ì„¤ì • ê´€ë¦¬',
            description: 'ëª¨ë“ˆ ì„¤ì • ë³€ê²½ ë° ê´€ë¦¬',
            roles: ['system_admin', 'brand_admin', 'branch_admin']
        },
        {
            name: 'ë°ì´í„° ì¡°íšŒ',
            description: 'ëª¨ë“ˆ ë°ì´í„° ì¡°íšŒ ë° ë¶„ì„',
            roles: ['system_admin', 'brand_admin', 'branch_admin', 'store_manager']
        },
        {
            name: 'ë°ì´í„° ìˆ˜ì •',
            description: 'ëª¨ë“ˆ ë°ì´í„° ìƒì„±, ìˆ˜ì •, ì‚­ì œ',
            roles: ['system_admin', 'brand_admin', 'branch_admin']
        },
        {
            name: 'ë³´ê³ ì„œ ìƒì„±',
            description: 'ëª¨ë“ˆ ê´€ë ¨ ë³´ê³ ì„œ ìƒì„± ë° ë‚´ë³´ë‚´ê¸°',
            roles: ['system_admin', 'brand_admin', 'branch_admin']
        },
        {
            name: 'ì‚¬ìš©ì ê´€ë¦¬',
            description: 'ëª¨ë“ˆ ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬',
            roles: ['system_admin', 'brand_admin']
        }
    ];
    
    const grid = document.getElementById('permissionsGrid');
    grid.innerHTML = '';
    
    permissions.forEach(permission => {
        const item = document.createElement('div');
        item.className = 'permission-item';
        
        item.innerHTML = `
            <div class="permission-header">
                <div class="permission-name">${permission.name}</div>
                <input type="checkbox" class="permission-checkbox" 
                       id="perm_${permission.name.replace(/\s+/g, '_')}"
                       ${permission.roles.includes('{{ current_user.role }}') ? 'checked' : ''}>
            </div>
            <div class="permission-description">${permission.description}</div>
        `;
        
        grid.appendChild(item);
    });
}

// ì„¤ì • ì €ì¥
function saveSettings() {
    showLoading();
    
    const settings = collectSettings();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/settings`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            currentSettings = settings;
        } else {
            alert('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('ì„¤ì • ì €ì¥ ì˜¤ë¥˜:', error);
        alert('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    })
    .finally(() => {
        hideLoading();
    });
}

// ì„¤ì • ìˆ˜ì§‘
function collectSettings() {
    const settings = {};
    
    // ì¼ë°˜ ì„¤ì •
    settings.module_enabled = document.getElementById('moduleEnabled').checked;
    settings.auto_start = document.getElementById('autoStart').checked;
    settings.debug_mode = document.getElementById('debugMode').checked;
    settings.email_notifications = document.getElementById('emailNotifications').checked;
    settings.push_notifications = document.getElementById('pushNotifications').checked;
    settings.notification_frequency = document.getElementById('notificationFrequency').value;
    settings.data_retention_days = parseInt(document.getElementById('dataRetentionDays').value);
    settings.auto_backup = document.getElementById('autoBackup').checked;
    settings.backup_frequency = document.getElementById('backupFrequency').value;
    
    // ê³ ê¸‰ ì„¤ì •
    settings.cache_ttl = parseInt(document.getElementById('cacheTTL').value);
    settings.max_concurrent = parseInt(document.getElementById('maxConcurrent').value);
    settings.log_level = document.getElementById('logLevel').value;
    settings.log_retention_days = parseInt(document.getElementById('logRetentionDays').value);
    settings.api_key = document.getElementById('apiKey').value;
    settings.ip_whitelist = document.getElementById('ipWhitelist').value;
    
    return settings;
}

// ì„¤ì • ì´ˆê¸°í™”
function resetSettings() {
    if (!confirm('ëª¨ë“  ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    // í¼ ì´ˆê¸°í™”
    document.getElementById('generalSettingsForm').reset();
    
    // ê¸°ë³¸ê°’ ì„¤ì •
    document.getElementById('dataRetentionDays').value = 365;
    document.getElementById('cacheTTL').value = 300;
    document.getElementById('maxConcurrent').value = 10;
    document.getElementById('logRetentionDays').value = 30;
    
    alert('ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ì„¤ì • ë‚´ë³´ë‚´ê¸°
function exportSettings() {
    const settings = collectSettings();
    const dataStr = JSON.stringify(settings, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `{{ module_id }}_settings.json`;
    link.click();
}

// ëª¨ë“ˆ í™œì„±í™”
function activateModule() {
    if (!confirm('ì´ ëª¨ë“ˆì„ í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/activate`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('í™œì„±í™” ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('ëª¨ë“ˆ í™œì„±í™” ì˜¤ë¥˜:', error);
        alert('ëª¨ë“ˆ í™œì„±í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    })
    .finally(() => {
        hideLoading();
    });
}

// ëª¨ë“ˆ ë¹„í™œì„±í™”
function deactivateModule() {
    if (!confirm('ì´ ëª¨ë“ˆì„ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/deactivate`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('ë¹„í™œì„±í™” ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('ëª¨ë“ˆ ë¹„í™œì„±í™” ì˜¤ë¥˜:', error);
        alert('ëª¨ë“ˆ ë¹„í™œì„±í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    })
    .finally(() => {
        hideLoading();
    });
}

// ëª¨ë“ˆ ì œê±°
function uninstallModule() {
    if (!confirm('ì´ ëª¨ë“ˆì„ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
    
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/uninstall`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            window.location.href = '/module-marketplace';
        } else {
            alert('ì œê±° ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('ëª¨ë“ˆ ì œê±° ì˜¤ë¥˜:', error);
        alert('ëª¨ë“ˆ ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    })
    .finally(() => {
        hideLoading();
    });
}

// ë°ëª¨ ì‹¤í–‰
function runDemo() {
    showLoading();
    
    fetch(`/api/marketplace/modules/{{ module_id }}/demo`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            } else {
                alert('ë°ëª¨ ì‹¤í–‰ ì‹¤íŒ¨: ' + data.error);
            }
        })
        .catch(error => {
            console.error('ë°ëª¨ ì‹¤í–‰ ì˜¤ë¥˜:', error);
            alert('ë°ëª¨ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        })
        .finally(() => {
            hideLoading();
        });
}

// ë¬¸ì„œ ë³´ê¸°
function viewDocumentation() {
    window.open('/docs/modules/{{ module_id }}', '_blank');
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
function setupEventListeners() {
    // ì„¤ì • ë³€ê²½ ê°ì§€
    document.querySelectorAll('input, select, textarea').forEach(element => {
        element.addEventListener('change', function() {
            // ì„¤ì •ì´ ë³€ê²½ë˜ì—ˆìŒì„ í‘œì‹œ
            console.log('ì„¤ì • ë³€ê²½ë¨:', this.id, this.value);
        });
    });
}

// ë¡œë”© í‘œì‹œ/ìˆ¨ê¹€
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}
</script>
{% endblock %} 