{% extends "base.html" %}

{% block title %}í†µí•© ì—°ë™ ëª¨ë“ˆ ë°ëª¨{% endblock %}

{% block extra_css %}
<style>
.integrated-demo-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.demo-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
    text-align: center;
}

.demo-title {
    font-size: 2.5rem;
    margin-bottom: 10px;
    font-weight: 700;
}

.demo-description {
    font-size: 1.1rem;
    opacity: 0.9;
    line-height: 1.6;
    margin-bottom: 20px;
}

.scenario-flow {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.flow-step {
    background: rgba(255,255,255,0.1);
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.flow-arrow {
    color: rgba(255,255,255,0.7);
    font-size: 18px;
}

.demo-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.demo-panel {
    background: white;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
}

.demo-panel h3 {
    color: #374151;
    margin-bottom: 20px;
    font-size: 1.3rem;
    font-weight: 600;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.realtime-data {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.data-card {
    background: #f8fafc;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    border-left: 4px solid #3b82f6;
}

.data-number {
    font-size: 1.8rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 5px;
}

.data-label {
    font-size: 0.9rem;
    color: #6b7280;
}

.integration-log {
    max-height: 300px;
    overflow-y: auto;
    background: #f8fafc;
    border-radius: 8px;
    padding: 15px;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
}

.log-entry {
    margin-bottom: 8px;
    padding: 5px;
    border-radius: 4px;
    border-left: 3px solid #e5e7eb;
}

.log-entry.info {
    background: #eff6ff;
    border-left-color: #3b82f6;
}

.log-entry.success {
    background: #f0fdf4;
    border-left-color: #10b981;
}

.log-entry.warning {
    background: #fffbeb;
    border-left-color: #f59e0b;
}

.log-entry.error {
    background: #fef2f2;
    border-left-color: #ef4444;
}

.log-timestamp {
    color: #6b7280;
    font-size: 0.8rem;
}

.log-message {
    color: #374151;
    margin-left: 10px;
}

.module-status {
    display: grid;
    gap: 10px;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: #f9fafb;
    border-radius: 6px;
    border-left: 4px solid #e5e7eb;
}

.status-item.active {
    border-left-color: #10b981;
    background: #f0fdf4;
}

.status-item.inactive {
    border-left-color: #6b7280;
    background: #f9fafb;
}

.status-item.error {
    border-left-color: #ef4444;
    background: #fef2f2;
}

.status-name {
    font-weight: 600;
    color: #374151;
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
}

.status-indicator.active {
    background: #10b981;
}

.status-indicator.inactive {
    background: #6b7280;
}

.status-indicator.error {
    background: #ef4444;
}

.status-details {
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-text {
    font-size: 0.9rem;
    color: #6b7280;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

.action-btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.action-btn-primary {
    background: #3b82f6;
    color: white;
}

.action-btn-primary:hover {
    background: #2563eb;
    transform: translateY(-1px);
}

.action-btn-success {
    background: #10b981;
    color: white;
}

.action-btn-success:hover {
    background: #059669;
}

.action-btn-warning {
    background: #f59e0b;
    color: white;
}

.action-btn-warning:hover {
    background: #d97706;
}

.action-btn-danger {
    background: #ef4444;
    color: white;
}

.action-btn-danger:hover {
    background: #dc2626;
}

.action-btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.action-btn-secondary:hover {
    background: #e5e7eb;
}

.efficiency-metrics {
    display: grid;
    gap: 15px;
}

.metric-card {
    background: #f8fafc;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #3b82f6;
}

.metric-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.metric-title {
    font-weight: 600;
    color: #374151;
}

.metric-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
}

.metric-description {
    font-size: 0.9rem;
    color: #6b7280;
}

.notification-list {
    max-height: 250px;
    overflow-y: auto;
}

.notification-item {
    padding: 12px;
    border-left: 4px solid #e5e7eb;
    margin-bottom: 10px;
    background: #f9fafb;
    border-radius: 0 8px 8px 0;
    transition: all 0.2s;
}

.notification-item:hover {
    background: #f3f4f6;
}

.notification-item.high {
    border-left-color: #ef4444;
    background: #fef2f2;
}

.notification-item.warning {
    border-left-color: #f59e0b;
    background: #fffbeb;
}

.notification-item.info {
    border-left-color: #3b82f6;
    background: #eff6ff;
}

.notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.notification-title {
    font-weight: 600;
    color: #1f2937;
    font-size: 0.9rem;
}

.notification-time {
    font-size: 0.8rem;
    color: #6b7280;
}

.notification-message {
    font-size: 0.85rem;
    color: #4b5563;
}

.demo-footer {
    background: #f8fafc;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    margin-top: 30px;
}

.demo-footer p {
    color: #6b7280;
    margin: 0;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .demo-content {
        grid-template-columns: 1fr;
    }
    
    .realtime-data {
        grid-template-columns: 1fr;
    }
    
    .scenario-flow {
        flex-direction: column;
    }
    
    .flow-arrow {
        transform: rotate(90deg);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="integrated-demo-container">
    <!-- ë°ëª¨ í—¤ë” -->
    <div class="demo-header">
        <h1 class="demo-title">ğŸ”„ í†µí•© ì—°ë™ ëª¨ë“ˆ ë°ëª¨</h1>
        <p class="demo-description">
            ëª¨ë“  ëª¨ë“ˆì´ ì¤‘ì•™ ë°ì´í„°ë¥¼ ê³µìœ í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ì—°ë™ë˜ëŠ” í†µí•© ì‹œìŠ¤í…œì„ ì²´í—˜í•´ë³´ì„¸ìš”.<br>
            ì¶œí‡´ê·¼ â†’ ë§¤ì¶œ â†’ ê¸‰ì—¬ â†’ ë¶„ì„ â†’ ì•Œë¦¼ì´ ìë™ìœ¼ë¡œ ì—°ë™ë©ë‹ˆë‹¤.
        </p>
        
        <div class="scenario-flow">
            <div class="flow-step">ğŸ“Š ì¶œí‡´ê·¼ ê¸°ë¡</div>
            <div class="flow-arrow">â†’</div>
            <div class="flow-step">ğŸ’° ë§¤ì¶œ ë°ì´í„°</div>
            <div class="flow-arrow">â†’</div>
            <div class="flow-step">ğŸ’µ ê¸‰ì—¬ ê³„ì‚°</div>
            <div class="flow-arrow">â†’</div>
            <div class="flow-step">ğŸ“ˆ íš¨ìœ¨ì„± ë¶„ì„</div>
            <div class="flow-arrow">â†’</div>
            <div class="flow-step">ğŸ”” ê´€ë¦¬ì ì•Œë¦¼</div>
        </div>
    </div>

    <!-- ë°ëª¨ ì½˜í…ì¸  -->
    <div class="demo-content">
        <!-- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ íŒ¨ë„ -->
        <div class="demo-panel">
            <h3>ğŸ“Š ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h3>
            
            <div class="realtime-data">
                <div class="data-card">
                    <div class="data-number" id="currentEmployees">0</div>
                    <div class="data-label">í˜„ì¬ ê·¼ë¬´ì</div>
                </div>
                <div class="data-card">
                    <div class="data-number" id="todaySales">0</div>
                    <div class="data-label">ì˜¤ëŠ˜ ë§¤ì¶œ</div>
                </div>
                <div class="data-card">
                    <div class="data-number" id="lateCount">0</div>
                    <div class="data-label">ì§€ê°ì</div>
                </div>
                <div class="data-card">
                    <div class="data-number" id="unreadNotifications">0</div>
                    <div class="data-label">ë¯¸ì½ ì•Œë¦¼</div>
                </div>
            </div>

            <h4>ğŸ”„ í†µí•© ì—°ë™ ë¡œê·¸</h4>
            <div class="integration-log" id="integrationLog">
                <div class="log-entry info">
                    <span class="log-timestamp">ì‹œìŠ¤í…œ ì‹œì‘</span>
                    <span class="log-message">í†µí•© ì—°ë™ ëª¨ë“ˆ ì‹œìŠ¤í…œì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn action-btn-primary" onclick="refreshRealtimeData()">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
                <button class="action-btn action-btn-success" onclick="runIntegratedScenario()">
                    ğŸ¯ í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
                </button>
            </div>
        </div>

        <!-- ëª¨ë“ˆ ìƒíƒœ ë° íš¨ìœ¨ì„± íŒ¨ë„ -->
        <div class="demo-panel">
            <h3>âš™ï¸ ëª¨ë“ˆ ìƒíƒœ</h3>
            
            <div class="module-status">
                <div class="status-item active">
                    <div class="status-details">
                        <div class="status-indicator active"></div>
                        <span class="status-name">ì¶œí‡´ê·¼ ê´€ë¦¬</span>
                    </div>
                    <span class="status-text">í™œì„±í™”ë¨</span>
                </div>
                <div class="status-item active">
                    <div class="status-details">
                        <div class="status-indicator active"></div>
                        <span class="status-name">ë§¤ì¶œ ê´€ë¦¬</span>
                    </div>
                    <span class="status-text">í™œì„±í™”ë¨</span>
                </div>
                <div class="status-item active">
                    <div class="status-details">
                        <div class="status-indicator active"></div>
                        <span class="status-name">ê¸‰ì—¬ ê´€ë¦¬</span>
                    </div>
                    <span class="status-text">í™œì„±í™”ë¨</span>
                </div>
                <div class="status-item active">
                    <div class="status-details">
                        <div class="status-indicator active"></div>
                        <span class="status-name">í†µí•© ë¶„ì„</span>
                    </div>
                    <span class="status-text">í™œì„±í™”ë¨</span>
                </div>
            </div>

            <h4 style="margin-top: 20px;">ğŸ“ˆ íš¨ìœ¨ì„± ì§€í‘œ</h4>
            <div class="efficiency-metrics">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">ì¸ê±´ë¹„ ë¹„ìœ¨</span>
                        <span class="metric-value" id="laborCostRatio">0%</span>
                    </div>
                    <div class="metric-description">ë§¤ì¶œ ëŒ€ë¹„ ì¸ê±´ë¹„ ë¹„ìœ¨</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">ì‹œê°„ë‹¹ ë§¤ì¶œ</span>
                        <span class="metric-value" id="salesPerHour">0ì›</span>
                    </div>
                    <div class="metric-description">ê·¼ë¬´ ì‹œê°„ë‹¹ í‰ê·  ë§¤ì¶œ</div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">ì¶œê·¼ë¥ </span>
                        <span class="metric-value" id="attendanceRate">0%</span>
                    </div>
                    <div class="metric-description">ì •ì‹œ ì¶œê·¼ë¥ </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ ë° ê°œì„  ì œì•ˆ íŒ¨ë„ -->
    <div class="demo-panel">
        <h3>ğŸ”” ì‹¤ì‹œê°„ ì•Œë¦¼</h3>
        
        <div class="notification-list" id="notificationList">
            <div class="notification-item info">
                <div class="notification-header">
                    <span class="notification-title">ì‹œìŠ¤í…œ ì‹œì‘</span>
                    <span class="notification-time">ë°©ê¸ˆ ì „</span>
                </div>
                <div class="notification-message">í†µí•© ì—°ë™ ëª¨ë“ˆ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn action-btn-warning" onclick="simulateAttendance()">
                â° ì¶œê·¼ ê¸°ë¡ ì‹œë®¬ë ˆì´ì…˜
            </button>
            <button class="action-btn action-btn-success" onclick="simulateSales()">
                ğŸ’° ë§¤ì¶œ ê¸°ë¡ ì‹œë®¬ë ˆì´ì…˜
            </button>
            <button class="action-btn action-btn-primary" onclick="simulatePayroll()">
                ğŸ’µ ê¸‰ì—¬ ê³„ì‚° ì‹œë®¬ë ˆì´ì…˜
            </button>
        </div>
    </div>

    <!-- ë°ëª¨ í‘¸í„° -->
    <div class="demo-footer">
        <p>ğŸ’¡ ì´ëŠ” í†µí•© ì—°ë™ ë°ëª¨ ëª¨ë“œì…ë‹ˆë‹¤. ì‹¤ì œ ì‹œìŠ¤í…œì—ì„œëŠ” ëª¨ë“  ëª¨ë“ˆì´ ì¤‘ì•™ ë°ì´í„°ë¥¼ ê³µìœ í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—°ë™ë©ë‹ˆë‹¤.</p>
        <p>ëª¨ë“  ë°ì´í„°ëŠ” ì¤‘ì•™ ë°ì´í„° ë ˆì´ì–´ì—ì„œ ê´€ë¦¬ë˜ë©°, ëª¨ë“ˆ ê°„ ìë™ ì—°ë™ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.</p>
    </div>
</div>

<script>
// ì‹¤ì‹œê°„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
function refreshRealtimeData() {
    fetch('/api/integrated/realtime/stream')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('currentEmployees').textContent = data.data.attendance.current_employees;
                document.getElementById('todaySales').textContent = data.data.sales.today_sales.toLocaleString() + 'ì›';
                document.getElementById('lateCount').textContent = data.data.attendance.late_count;
                document.getElementById('unreadNotifications').textContent = data.data.notifications.unread_count;
                
                addLogEntry('info', 'ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            addLogEntry('error', 'ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
        });
}

// í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
function runIntegratedScenario() {
    addLogEntry('info', 'í†µí•© ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
    
    fetch('/api/integrated/demo/integrated-scenario', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            addLogEntry('success', 'í†µí•© ì‹œë‚˜ë¦¬ì˜¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ë³„ ë¡œê·¸ ì¶”ê°€
            data.scenario.forEach((step, index) => {
                setTimeout(() => {
                    addLogEntry('info', step);
                }, (index + 1) * 1000);
            });
            
            // 5ì´ˆ í›„ ì‹¤ì‹œê°„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                refreshRealtimeData();
                loadNotifications();
                loadEfficiencyMetrics();
            }, 5000);
        } else {
            addLogEntry('error', 'í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        addLogEntry('error', 'í†µí•© ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
    });
}

// ì¶œê·¼ ê¸°ë¡ ì‹œë®¬ë ˆì´ì…˜
function simulateAttendance() {
    addLogEntry('info', 'ì¶œê·¼ ê¸°ë¡ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤...');
    
    fetch('/api/integrated/attendance/record', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            employee_id: 1,
            branch_id: 1,
            action: 'clock_in'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            addLogEntry('success', 'ì¶œê·¼ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            setTimeout(() => refreshRealtimeData(), 1000);
        } else {
            addLogEntry('error', 'ì¶œê·¼ ê¸°ë¡ ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        addLogEntry('error', 'ì¶œê·¼ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
    });
}

// ë§¤ì¶œ ê¸°ë¡ ì‹œë®¬ë ˆì´ì…˜
function simulateSales() {
    addLogEntry('info', 'ë§¤ì¶œ ê¸°ë¡ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤...');
    
    fetch('/api/integrated/sales/record', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            employee_id: 1,
            branch_id: 1,
            amount: 50000,
            category: 'ìŒë£Œ'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            addLogEntry('success', 'ë§¤ì¶œì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            setTimeout(() => refreshRealtimeData(), 1000);
        } else {
            addLogEntry('error', 'ë§¤ì¶œ ê¸°ë¡ ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        addLogEntry('error', 'ë§¤ì¶œ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
    });
}

// ê¸‰ì—¬ ê³„ì‚° ì‹œë®¬ë ˆì´ì…˜
function simulatePayroll() {
    addLogEntry('info', 'ê¸‰ì—¬ ê³„ì‚°ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤...');
    
    fetch('/api/integrated/payroll/calculate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            employee_id: 1,
            branch_id: 1,
            year: new Date().getFullYear(),
            month: new Date().getMonth() + 1
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            addLogEntry('success', 'ê¸‰ì—¬ê°€ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.');
            setTimeout(() => {
                refreshRealtimeData();
                loadEfficiencyMetrics();
            }, 1000);
        } else {
            addLogEntry('error', 'ê¸‰ì—¬ ê³„ì‚° ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        addLogEntry('error', 'ê¸‰ì—¬ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
    });
}

// ì•Œë¦¼ ëª©ë¡ ë¡œë“œ
function loadNotifications() {
    fetch('/api/integrated/notifications')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const notificationList = document.getElementById('notificationList');
                notificationList.innerHTML = '';
                
                data.data.slice(0, 5).forEach(notification => {
                    const notificationItem = document.createElement('div');
                    notificationItem.className = `notification-item ${notification.priority}`;
                    
                    const time = new Date(notification.created_at).toLocaleTimeString();
                    
                    notificationItem.innerHTML = `
                        <div class="notification-header">
                            <span class="notification-title">${notification.title}</span>
                            <span class="notification-time">${time}</span>
                        </div>
                        <div class="notification-message">${notification.message}</div>
                    `;
                    
                    notificationList.appendChild(notificationItem);
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// íš¨ìœ¨ì„± ì§€í‘œ ë¡œë“œ
function loadEfficiencyMetrics() {
    fetch('/api/integrated/efficiency/1')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const efficiency = data.data.efficiency;
                
                document.getElementById('laborCostRatio').textContent = 
                    (efficiency.labor_cost_ratio || 0).toFixed(1) + '%';
                
                document.getElementById('salesPerHour').textContent = 
                    Math.round(efficiency.sales_per_employee || 0).toLocaleString() + 'ì›';
                
                const attendance = data.data.attendance;
                const attendanceRate = attendance.total_records > 0 ? 
                    ((attendance.total_records - attendance.late_count) / attendance.total_records * 100) : 0;
                document.getElementById('attendanceRate').textContent = 
                    attendanceRate.toFixed(1) + '%';
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// ë¡œê·¸ ì—”íŠ¸ë¦¬ ì¶”ê°€
function addLogEntry(type, message) {
    const log = document.getElementById('integrationLog');
    const logEntry = document.createElement('div');
    logEntry.className = `log-entry ${type}`;
    
    const timestamp = new Date().toLocaleTimeString();
    
    logEntry.innerHTML = `
        <span class="log-timestamp">${timestamp}</span>
        <span class="log-message">${message}</span>
    `;
    
    log.appendChild(logEntry);
    log.scrollTop = log.scrollHeight;
    
    // ìµœëŒ€ 20ê°œ ë¡œê·¸ë§Œ ìœ ì§€
    if (log.children.length > 20) {
        log.removeChild(log.firstChild);
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    refreshRealtimeData();
    loadNotifications();
    loadEfficiencyMetrics();
    
    // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
    setInterval(refreshRealtimeData, 30000);
    setInterval(loadNotifications, 30000);
});
</script>
{% endblock %} 