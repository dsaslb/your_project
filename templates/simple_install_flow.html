{% extends "simple_base.html" %}

{% block title %}{{ module.name }} ì„¤ì¹˜ - ê°„ë‹¨í•œ ëª¨ë“ˆ ë§ˆì¼“í”Œë ˆì´ìŠ¤{% endblock %}

{% block content %}
<div class="card">
    <h2>{{ module.name }} ëª¨ë“ˆ ì„¤ì¹˜</h2>
    <p>{{ module.description }}</p>
</div>

<!-- ì§„í–‰ ìƒíƒœ í‘œì‹œ -->
<div class="card" style="margin-top: 1rem;">
    <h3>ì„¤ì¹˜ ì§„í–‰ ìƒí™©</h3>
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
        </div>
        <div class="progress-steps">
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <div class="step-label">ì„¤ì¹˜</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-label">í™œì„±í™”</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-label">ì„¤ì •</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div class="step-label">ì˜¨ë³´ë”©</div>
            </div>
        </div>
    </div>
</div>

<!-- ë‹¨ê³„ë³„ ì»¨í…ì¸  -->
<div class="step-content" id="stepContent">
    <!-- 1ë‹¨ê³„: ì„¤ì¹˜ -->
    <div class="step-panel" id="step1Panel">
        <div class="card">
            <h3>1ë‹¨ê³„: ëª¨ë“ˆ ì„¤ì¹˜</h3>
            <p>{{ module.name }} ëª¨ë“ˆì„ ì‹œìŠ¤í…œì— ì„¤ì¹˜í•©ë‹ˆë‹¤.</p>
            <div class="module-info">
                <h4>ëª¨ë“ˆ ì •ë³´</h4>
                <ul>
                    <li><strong>ë²„ì „:</strong> {{ module.version }}</li>
                    <li><strong>ì‘ì„±ì:</strong> {{ module.author }}</li>
                    <li><strong>ì¹´í…Œê³ ë¦¬:</strong> {{ module.category }}</li>
                </ul>
            </div>
            <button class="btn btn-success" onclick="startInstallation()">ì„¤ì¹˜ ì‹œì‘</button>
        </div>
    </div>

    <!-- 2ë‹¨ê³„: ì„¤ì • -->
    <div class="step-panel" id="step2Panel" style="display: none;">
        <div class="card">
            <h3>2ë‹¨ê³„: ëª¨ë“ˆ ì„¤ì •</h3>
            <p>{{ module.name }} ëª¨ë“ˆì˜ ê¸°ë³¸ ì„¤ì •ì„ êµ¬ì„±í•©ë‹ˆë‹¤.</p>
            
            <div class="form-group">
                <label>ì•Œë¦¼ ì„¤ì •</label>
                <select id="notificationSetting" class="form-control">
                    <option value="all">ëª¨ë“  ì•Œë¦¼ ë°›ê¸°</option>
                    <option value="important">ì¤‘ìš” ì•Œë¦¼ë§Œ</option>
                    <option value="none">ì•Œë¦¼ ë°›ì§€ ì•Šê¸°</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ë°ì´í„° ë°±ì—…</label>
                <select id="backupSetting" class="form-control">
                    <option value="daily">ë§¤ì¼</option>
                    <option value="weekly">ë§¤ì£¼</option>
                    <option value="monthly">ë§¤ì›”</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ê¶Œí•œ ì„¤ì •</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="permissionView" checked> ì¡°íšŒ ê¶Œí•œ</label>
                    <label><input type="checkbox" id="permissionEdit" checked> í¸ì§‘ ê¶Œí•œ</label>
                    <label><input type="checkbox" id="permissionDelete"> ì‚­ì œ ê¶Œí•œ</label>
                </div>
            </div>
            
            <button class="btn btn-success" onclick="configureModule()">ì„¤ì • ì™„ë£Œ</button>
        </div>
    </div>

    <!-- 3ë‹¨ê³„: ì˜¨ë³´ë”© -->
    <div class="step-panel" id="step3Panel" style="display: none;">
        <div class="card">
            <h3>3ë‹¨ê³„: ì‚¬ìš©ë²• ì•ˆë‚´</h3>
            <p>{{ module.name }} ëª¨ë“ˆì˜ ì£¼ìš” ê¸°ëŠ¥ì„ ì•Œì•„ë³´ì„¸ìš”.</p>
            
            <div class="onboarding-content">
                <h4>ì£¼ìš” ê¸°ëŠ¥</h4>
                <ul>
                    {% for feature in module.features %}
                    <li>{{ feature }}</li>
                    {% endfor %}
                </ul>
                
                <h4>ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ</h4>
                <div class="quick-guide">
                    <div class="guide-step">
                        <div class="guide-number">1</div>
                        <div class="guide-text">ë©”ë‰´ì—ì„œ "{{ module.name }}"ì„ í´ë¦­í•˜ì„¸ìš”</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-number">2</div>
                        <div class="guide-text">ê¸°ë³¸ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-number">3</div>
                        <div class="guide-text">ëª¨ë“ˆì„ ì‚¬ìš©í•´ë³´ì„¸ìš”!</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-success" onclick="completeOnboarding()">ì˜¨ë³´ë”© ì™„ë£Œ</button>
        </div>
    </div>

    <!-- 4ë‹¨ê³„: ì™„ë£Œ -->
    <div class="step-panel" id="step4Panel" style="display: none;">
        <div class="card">
            <h3>ğŸ‰ ì„¤ì¹˜ ì™„ë£Œ!</h3>
            <p>{{ module.name }} ëª¨ë“ˆì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            
            <div class="completion-info">
                <h4>ë‹¤ìŒ ë‹¨ê³„</h4>
                <ul>
                    <li>ëŒ€ì‹œë³´ë“œì—ì„œ "{{ module.name }}" ë©”ë‰´ë¥¼ í™•ì¸í•˜ì„¸ìš”</li>
                    <li>ëª¨ë“ˆì„ ì‚¬ìš©í•´ë³´ì„¸ìš”</li>
                    <li>ë¬¸ì œê°€ ìˆìœ¼ë©´ ì„¤ì •ì—ì„œ ë„ì›€ë§ì„ í™•ì¸í•˜ì„¸ìš”</li>
                </ul>
            </div>
            
            <div class="action-buttons">
                <a href="{{ url_for('dashboard') }}" class="btn btn-success">ëŒ€ì‹œë³´ë“œë¡œ ì´ë™</a>
                <a href="{{ url_for('marketplace') }}" class="btn">ë§ˆì¼“í”Œë ˆì´ìŠ¤ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </div>
    </div>
</div>

<style>
.progress-container {
    margin: 2rem 0;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #27ae60, #2ecc71);
    transition: width 0.3s ease;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    margin-top: 1rem;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e0e0e0;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
}

.step.active .step-number {
    background: #27ae60;
    color: white;
}

.step.completed .step-number {
    background: #2ecc71;
    color: white;
}

.step-label {
    font-size: 0.9rem;
    color: #666;
    text-align: center;
}

.step.active .step-label {
    color: #27ae60;
    font-weight: bold;
}

.step.completed .step-label {
    color: #2ecc71;
}

.step-panel {
    margin-top: 2rem;
}

.module-info {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.module-info ul {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-control {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
}

.onboarding-content {
    margin: 1rem 0;
}

.quick-guide {
    margin: 1rem 0;
}

.guide-step {
    display: flex;
    align-items: center;
    margin: 1rem 0;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 4px;
}

.guide-number {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #27ae60;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 1rem;
}

.completion-info {
    background: #d4edda;
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

@media (max-width: 768px) {
    .progress-steps {
        flex-direction: column;
        gap: 1rem;
    }
    
    .step {
        flex-direction: row;
        gap: 1rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
}
</style>

<script>
let currentStep = 1;
let installationId = null;

function updateProgress(step, progress) {
    // ì§„í–‰ ë°” ì—…ë°ì´íŠ¸
    document.getElementById('progressFill').style.width = progress + '%';
    
    // ë‹¨ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
    for (let i = 1; i <= 4; i++) {
        const stepElement = document.getElementById('step' + i);
        if (i < step) {
            stepElement.className = 'step completed';
        } else if (i === step) {
            stepElement.className = 'step active';
        } else {
            stepElement.className = 'step';
        }
    }
}

function showStep(step) {
    // ëª¨ë“  ë‹¨ê³„ ìˆ¨ê¸°ê¸°
    for (let i = 1; i <= 4; i++) {
        document.getElementById('step' + i + 'Panel').style.display = 'none';
    }
    
    // í˜„ì¬ ë‹¨ê³„ ë³´ì´ê¸°
    document.getElementById('step' + step + 'Panel').style.display = 'block';
    
    currentStep = step;
}

function startInstallation() {
    fetch(`/api/modules/{{ module.id }}/install`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            installationId = data.installation_id;
            updateProgress(2, data.progress);
            showStep(2);
        } else {
            alert('ì„¤ì¹˜ ì‹¤íŒ¨: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

function configureModule() {
    const settings = {
        notification: document.getElementById('notificationSetting').value,
        backup: document.getElementById('backupSetting').value,
        permissions: {
            view: document.getElementById('permissionView').checked,
            edit: document.getElementById('permissionEdit').checked,
            delete: document.getElementById('permissionDelete').checked
        }
    };
    
    fetch(`/api/modules/{{ module.id }}/configure`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            installation_id: installationId,
            settings: settings
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateProgress(3, data.progress);
            showStep(3);
        } else {
            alert('ì„¤ì • ì‹¤íŒ¨: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

function completeOnboarding() {
    fetch(`/api/modules/{{ module.id }}/onboarding`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            installation_id: installationId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateProgress(4, data.progress);
            showStep(4);
        } else {
            alert('ì˜¨ë³´ë”© ì‹¤íŒ¨: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¨ë³´ë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    updateProgress(1, 25);
    showStep(1);
});
</script>
{% endblock %} 